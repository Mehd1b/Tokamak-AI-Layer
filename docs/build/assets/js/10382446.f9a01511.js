"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[2849],{1671(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"architecture/trust-model","title":"Trust Model","description":"TAL\'s trust model is designed around the principle that different use cases require different security guarantees. A low-stakes chatbot lookup needs only reputation feedback, while a DeFi strategy execution requires cryptographic proof of correct computation backed by slashable economic stake. This page covers the security assumptions, mathematical foundations, and enforcement mechanisms behind each trust tier.","source":"@site/docs/architecture/trust-model.md","sourceDirName":"architecture","slug":"/architecture/trust-model","permalink":"/tal/architecture/trust-model","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/architecture/trust-model.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Trust Model","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Architecture Overview","permalink":"/tal/architecture/overview"},"next":{"title":"Cross-Layer Bridge","permalink":"/tal/architecture/cross-layer-bridge"}}');var s=t(4848),r=t(8453);const a={title:"Trust Model",sidebar_position:2},d="Trust Model",l={},o=[{value:"Security Assumptions",id:"security-assumptions",level:2},{value:"Stake-Weighted Trust",id:"stake-weighted-trust",level:2},{value:"How Staked TON Affects Reputation Weight",id:"how-staked-ton-affects-reputation-weight",level:3},{value:"ReputationMath Constants",id:"reputationmath-constants",level:3},{value:"Reputation Decay",id:"reputation-decay",level:3},{value:"DRB Fairness",id:"drb-fairness",level:2},{value:"Selection Algorithm",id:"selection-algorithm",level:3},{value:"DRB Integration Constants",id:"drb-integration-constants",level:3},{value:"TEE Attestation",id:"tee-attestation",level:2},{value:"Supported Enclave Types",id:"supported-enclave-types",level:3},{value:"Provider Management",id:"provider-management",level:3},{value:"Slashing Conditions",id:"slashing-conditions",level:2},{value:"Severity Levels",id:"severity-levels",level:3},{value:"Slash Calculation",id:"slash-calculation",level:3},{value:"Cumulative Slashing",id:"cumulative-slashing",level:3},{value:"SlashingCalculator Constants",id:"slashingcalculator-constants",level:3},{value:"Bounty Distribution",id:"bounty-distribution",level:2},{value:"Distribution Constants",id:"distribution-constants",level:3},{value:"Concrete Example",id:"concrete-example",level:3},{value:"Minimum Bounty Requirements",id:"minimum-bounty-requirements",level:3},{value:"Dispute Mechanism",id:"dispute-mechanism",level:2},{value:"Who Can Dispute",id:"who-can-dispute",level:3},{value:"Dispute Flow",id:"dispute-flow",level:3},{value:"Dispute Rules",id:"dispute-rules",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Front-Running Protection",id:"front-running-protection",level:3},{value:"Replay Attack Prevention",id:"replay-attack-prevention",level:3},{value:"Reentrancy Protection",id:"reentrancy-protection",level:3},{value:"Cross-Layer Security",id:"cross-layer-security",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"trust-model",children:"Trust Model"})}),"\n",(0,s.jsx)(n.p,{children:"TAL's trust model is designed around the principle that different use cases require different security guarantees. A low-stakes chatbot lookup needs only reputation feedback, while a DeFi strategy execution requires cryptographic proof of correct computation backed by slashable economic stake. This page covers the security assumptions, mathematical foundations, and enforcement mechanisms behind each trust tier."}),"\n",(0,s.jsx)(n.h2,{id:"security-assumptions",children:"Security Assumptions"}),"\n",(0,s.jsx)(n.p,{children:"TAL's security rests on three independent pillars, any combination of which can be composed per validation request:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Economic security"})," -- Operators stake TON on Ethereum L1. Misbehavior is punished by slashing, making attacks economically irrational when the stake exceeds the potential gain."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cryptographic fairness"})," -- Validator selection uses Tokamak's DRB (Decentralized Random Beacon) with the Commit-Reveal2 protocol, producing randomness that is verifiably unbiasable and unpredictable."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hardware integrity"})," -- TEE attestation (Intel SGX, AWS Nitro, ARM TrustZone) provides tamper-proof execution guarantees that are independent of economic incentives."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"No single assumption is relied upon in isolation for high-trust validations. The Hybrid tier combines all three, ensuring that a validator must be economically committed, randomly selected, and hardware-verified."})}),"\n",(0,s.jsx)(n.h2,{id:"stake-weighted-trust",children:"Stake-Weighted Trust"}),"\n",(0,s.jsx)(n.h3,{id:"how-staked-ton-affects-reputation-weight",children:"How Staked TON Affects Reputation Weight"}),"\n",(0,s.jsx)(n.p,{children:"Reputation feedback is weighted by the reviewer's L1 stake using a square root formula. This prevents plutocracy (where large stakers dominate) while still giving skin-in-the-game participants more influence than unstaked reviewers."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"// From contracts/src/libraries/ReputationMath.sol\n\nfunction calculateWeightedAverage(\n    int128[] memory values,\n    uint256[] memory stakes\n) internal pure returns (int256 weightedAverage) {\n    int256 weightedSum = 0;\n    uint256 totalWeight = 0;\n\n    for (uint256 i = 0; i < values.length; i++) {\n        uint256 weight = sqrt(stakes[i]);\n        weightedSum += int256(values[i]) * int256(weight);\n        totalWeight += weight;\n    }\n\n    if (totalWeight == 0) return 0;\n    return (weightedSum * int256(PRECISION)) / int256(totalWeight);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"sqrt()"})," weighting means a reviewer staking 10,000 TON has only 10x the influence of one staking 100 TON (not 100x), making Sybil attacks via stake concentration unprofitable."]}),"\n",(0,s.jsx)(n.h3,{id:"reputationmath-constants",children:"ReputationMath Constants"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Constant"}),(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PRECISION"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1e18"})}),(0,s.jsx)(n.td,{children:"Fixed-point precision for weighted averages"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MAX_SCORE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"100"})}),(0,s.jsx)(n.td,{children:"Maximum feedback value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MIN_SCORE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"-100"})}),(0,s.jsx)(n.td,{children:"Minimum feedback value"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"reputation-decay",children:"Reputation Decay"}),"\n",(0,s.jsx)(n.p,{children:"Feedback loses weight over time via linear decay:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"decayFactor = 1 - (elapsed / maxAge)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"elapsed >= maxAge"}),", the feedback has zero weight. This ensures reputation reflects recent behavior, not historical performance that may no longer be relevant."]}),"\n",(0,s.jsx)(n.admonition,{title:"Where in the code?",type:"tip",children:(0,s.jsxs)(n.p,{children:["All reputation math functions are in ",(0,s.jsx)(n.a,{href:"/contracts/reputation-registry",children:(0,s.jsx)(n.code,{children:"contracts/src/libraries/ReputationMath.sol"})})," (138 lines). The library provides ",(0,s.jsx)(n.code,{children:"calculateWeightedAverage()"}),", ",(0,s.jsx)(n.code,{children:"calculateStakeWeight()"}),", ",(0,s.jsx)(n.code,{children:"normalizeScore()"}),", ",(0,s.jsx)(n.code,{children:"aggregateFeedback()"}),", and ",(0,s.jsx)(n.code,{children:"calculateDecay()"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"drb-fairness",children:"DRB Fairness"}),"\n",(0,s.jsx)(n.p,{children:"For StakeSecured and Hybrid validation models, the validator is selected using Tokamak's Decentralized Random Beacon (DRB) via the Commit-Reveal2 protocol."}),"\n",(0,s.jsx)(n.h3,{id:"selection-algorithm",children:"Selection Algorithm"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant VR as TALValidationRegistry\n    participant DRB as DRBIntegrationModule\n    participant CR2 as CommitReveal2 Coordinator\n\n    VR->>DRB: requestValidatorSelection(requestHash, candidates, stakes)\n    DRB->>CR2: Request randomness (with ETH fee)\n    Note over CR2: Commit-Reveal\xb2 protocol runs<br/>(multiple operators commit, reveal, aggregate)\n    CR2->>DRB: rawFulfillRandomNumber(round, randomNumber)\n    DRB--\x3e>DRB: Store delivered randomness\n    VR->>DRB: finalizeValidatorSelection(requestHash, candidates, stakes)\n    DRB--\x3e>VR: Selected validator (stake-weighted)"}),"\n",(0,s.jsx)(n.p,{children:"The selection uses a cumulative sum approach with stake-based weights:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Each candidate's weight equals their staked TON amount (linear, not square root -- unlike reputation weighting, higher stake means higher selection probability for validators)."}),"\n",(0,s.jsx)(n.li,{children:"A cumulative weight array is constructed from the candidates."}),"\n",(0,s.jsx)(n.li,{children:"The DRB random number modulo total weight determines the index."}),"\n",(0,s.jsx)(n.li,{children:"The candidate whose cumulative weight range contains that index is selected."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["If the DRB module is not configured, the contract falls back to ",(0,s.jsx)(n.code,{children:"blockhash"}),"-based randomness. This is not secure for production -- validators can manipulate block hashes. The DRB module ",(0,s.jsx)(n.strong,{children:"must"})," be set for mainnet deployment."]})}),"\n",(0,s.jsx)(n.h3,{id:"drb-integration-constants",children:"DRB Integration Constants"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Constant"}),(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEFAULT_CALLBACK_GAS_LIMIT"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"100,000"})}),(0,s.jsx)(n.td,{children:"Gas limit for the DRB callback"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"callbackGasLimit"})}),(0,s.jsx)(n.td,{children:"Configurable"}),(0,s.jsx)(n.td,{children:"Actual gas limit used per request"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"tee-attestation",children:"TEE Attestation"}),"\n",(0,s.jsx)(n.p,{children:"TEE (Trusted Execution Environment) attestation provides hardware-backed verification that code executed correctly inside a secure enclave."}),"\n",(0,s.jsx)(n.h3,{id:"supported-enclave-types",children:"Supported Enclave Types"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Enclave"}),(0,s.jsx)(n.th,{children:"Provider"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Intel SGX"}),(0,s.jsx)(n.td,{children:"Intel"}),(0,s.jsx)(n.td,{children:"Software Guard Extensions -- isolated memory enclaves on x86 processors"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"AWS Nitro"}),(0,s.jsx)(n.td,{children:"Amazon"}),(0,s.jsx)(n.td,{children:"Nitro Enclaves -- isolated VMs on AWS EC2 with cryptographic attestation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ARM TrustZone"}),(0,s.jsx)(n.td,{children:"ARM"}),(0,s.jsx)(n.td,{children:"Hardware isolation on ARM processors, common in mobile/edge devices"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"provider-management",children:"Provider Management"}),"\n",(0,s.jsxs)(n.p,{children:["TEE providers are whitelisted by the ",(0,s.jsx)(n.code,{children:"TEE_MANAGER_ROLE"})," on ",(0,s.jsx)(n.code,{children:"TALValidationRegistry"}),". Each provider has an associated enclave hash for verification:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"// Only TEE_MANAGER_ROLE can add providers\nfunction setTrustedTEEProvider(address provider) external onlyRole(TEE_MANAGER_ROLE);\nfunction removeTrustedTEEProvider(address provider) external onlyRole(TEE_MANAGER_ROLE);\n"})}),"\n",(0,s.jsx)(n.p,{children:"When a TEEAttested or Hybrid validation is submitted, the proof bytes are decoded to extract the attestation provider, enclave hash, and signature. The contract verifies the provider is trusted and the attestation is valid."}),"\n",(0,s.jsx)(n.h2,{id:"slashing-conditions",children:"Slashing Conditions"}),"\n",(0,s.jsxs)(n.p,{children:["Slashing is TAL's enforcement mechanism. When misbehavior is detected on L2, a slash request is relayed to L1 where it executes against the operator's staked TON via ",(0,s.jsx)(n.code,{children:"DepositManager.slash()"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"severity-levels",children:"Severity Levels"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Condition"}),(0,s.jsx)(n.th,{children:"Slash %"}),(0,s.jsx)(n.th,{children:"Trigger"}),(0,s.jsx)(n.th,{children:"Threshold"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Failed TEE Attestation"})}),(0,s.jsx)(n.td,{children:"50%"}),(0,s.jsx)(n.td,{children:"TEE attestation verification fails for a submitted validation"}),(0,s.jsx)(n.td,{children:"Automatic on proof failure"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Proven Validator Fraud"})}),(0,s.jsx)(n.td,{children:"100%"}),(0,s.jsx)(n.td,{children:"Validator provably submitted false validation results"}),(0,s.jsx)(n.td,{children:"Dispute resolution upholds challenger"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Repeated Low Reputation"})}),(0,s.jsx)(n.td,{children:"25%"}),(0,s.jsx)(n.td,{children:"Operator's aggregate reputation falls below threshold"}),(0,s.jsxs)(n.td,{children:["Reputation score < ",(0,s.jsx)(n.code,{children:"-50"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"DAO Adjudicated"})}),(0,s.jsx)(n.td,{children:"Variable (0-100%)"}),(0,s.jsx)(n.td,{children:"Governance vote determines severity for edge cases"}),(0,s.jsx)(n.td,{children:"Custom percentage set by governance"})]})]})]}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsx)(n.p,{children:"Proven fraud results in 100% stake loss. There is no partial forgiveness for deliberate falsification of validation results."})}),"\n",(0,s.jsx)(n.h3,{id:"slash-calculation",children:"Slash Calculation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"// From contracts/src/libraries/SlashingCalculator.sol\n\nfunction calculateSlashAmount(SlashParams memory params)\n    internal pure\n    returns (uint256 slashAmount, uint256 percentage)\n{\n    if (params.operatorStake < MIN_SLASHABLE_STAKE) {\n        return (0, 0); // Dust threshold: < 1 TON\n    }\n\n    percentage = getSlashPercentage(params.reason, params.customPercentage);\n    slashAmount = (params.operatorStake * percentage) / 100;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cumulative-slashing",children:"Cumulative Slashing"}),"\n",(0,s.jsx)(n.p,{children:"Multiple offenses are applied sequentially -- each slash reduces the remaining stake before the next is calculated:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"function calculateCumulativeSlash(\n    uint256 stake,\n    uint256[] memory percentages\n) internal pure returns (uint256 totalSlashed, uint256 remainingStake) {\n    remainingStake = stake;\n    for (uint256 i = 0; i < percentages.length; i++) {\n        uint256 slashAmount = (remainingStake * pct) / 100;\n        totalSlashed += slashAmount;\n        remainingStake -= slashAmount;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"For example, an operator with 10,000 TON who receives a 50% slash (TEE failure) followed by a 25% slash (low reputation) loses 5,000 + 1,250 = 6,250 TON, retaining 3,750 TON."}),"\n",(0,s.jsx)(n.h3,{id:"slashingcalculator-constants",children:"SlashingCalculator Constants"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Constant"}),(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SLASH_FAILED_TEE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"50"})}),(0,s.jsx)(n.td,{children:"Percentage slashed for failed TEE attestation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SLASH_PROVEN_FRAUD"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"100"})}),(0,s.jsx)(n.td,{children:"Percentage slashed for proven fraud"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SLASH_LOW_REPUTATION"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"25"})}),(0,s.jsx)(n.td,{children:"Percentage slashed for low reputation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MAX_SLASH_PERCENTAGE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"100"})}),(0,s.jsx)(n.td,{children:"Maximum slash percentage cap"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MIN_SLASHABLE_STAKE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1 ether"})}),(0,s.jsx)(n.td,{children:"Minimum stake below which slashing is skipped"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LOW_REPUTATION_THRESHOLD"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"-50"})}),(0,s.jsx)(n.td,{children:"Reputation score below which low-rep slashing triggers"})]})]})]}),"\n",(0,s.jsx)(n.admonition,{title:"Where in the code?",type:"tip",children:(0,s.jsxs)(n.p,{children:["Slashing math is in ",(0,s.jsx)(n.code,{children:"contracts/src/libraries/SlashingCalculator.sol"})," (162 lines). Cross-layer slashing execution is in ",(0,s.jsx)(n.a,{href:"/architecture/cross-layer-bridge",children:(0,s.jsx)(n.code,{children:"contracts/src/bridge/TALSlashingConditionsL1.sol"})}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"bounty-distribution",children:"Bounty Distribution"}),"\n",(0,s.jsx)(n.p,{children:"When a validation is completed, the bounty attached to the request is distributed among three parties:"}),"\n",(0,s.jsx)(n.mermaid,{value:"flowchart LR\n    B[Bounty] --\x3e T[Treasury<br/>10%]\n    B --\x3e R[Remaining<br/>90%]\n    R --\x3e A[Agent Owner<br/>10% of remaining]\n    R --\x3e V[Validator<br/>90% of remaining]"}),"\n",(0,s.jsx)(n.h3,{id:"distribution-constants",children:"Distribution Constants"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Constant"}),(0,s.jsx)(n.th,{children:"Value (BPS)"}),(0,s.jsx)(n.th,{children:"Effective %"}),(0,s.jsx)(n.th,{children:"Recipient"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PROTOCOL_FEE_BPS"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1000"})}),(0,s.jsx)(n.td,{children:"10% of total bounty"}),(0,s.jsx)(n.td,{children:"Protocol treasury"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AGENT_REWARD_BPS"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1000"})}),(0,s.jsx)(n.td,{children:"10% of remaining (9% of total)"}),(0,s.jsx)(n.td,{children:"Agent NFT owner"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VALIDATOR_REWARD_BPS"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"8000"})}),(0,s.jsx)(n.td,{children:"80% of remaining (72% of total)"}),(0,s.jsx)(n.td,{children:"Validator who submitted result"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"concrete-example",children:"Concrete Example"}),"\n",(0,s.jsx)(n.p,{children:"For a 10 TON bounty:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Treasury receives: 10 * 10% = ",(0,s.jsx)(n.strong,{children:"1 TON"})]}),"\n",(0,s.jsxs)(n.li,{children:["Remaining: 10 - 1 = ",(0,s.jsx)(n.strong,{children:"9 TON"})]}),"\n",(0,s.jsxs)(n.li,{children:["Agent owner receives: 9 * 10% = ",(0,s.jsx)(n.strong,{children:"0.9 TON"})]}),"\n",(0,s.jsxs)(n.li,{children:["Validator receives: 9 - 0.9 = ",(0,s.jsx)(n.strong,{children:"8.1 TON"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"minimum-bounty-requirements",children:"Minimum Bounty Requirements"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Validation Model"}),(0,s.jsx)(n.th,{children:"Minimum Bounty"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ReputationOnly"}),(0,s.jsx)(n.td,{children:"0 (no bounty required)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"StakeSecured"}),(0,s.jsxs)(n.td,{children:["10 TON (",(0,s.jsx)(n.code,{children:"MIN_STAKE_SECURED_BOUNTY"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TEEAttested"}),(0,s.jsxs)(n.td,{children:["1 TON (",(0,s.jsx)(n.code,{children:"MIN_TEE_BOUNTY"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Hybrid"}),(0,s.jsx)(n.td,{children:"10 TON (uses StakeSecured minimum)"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"dispute-mechanism",children:"Dispute Mechanism"}),"\n",(0,s.jsx)(n.p,{children:"Any completed validation can be challenged through the dispute process."}),"\n",(0,s.jsx)(n.h3,{id:"who-can-dispute",children:"Who Can Dispute"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.strong,{children:"original requester"})," who paid for the validation"]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.strong,{children:"agent owner"})," (NFT holder)"]}),"\n",(0,s.jsxs)(n.li,{children:["Any ",(0,s.jsx)(n.strong,{children:"registered validator"})," (anyone with validation submission history)"]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.strong,{children:"selected validator"})," for the specific request"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dispute-flow",children:"Dispute Flow"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant D as Disputer\n    participant VR as TALValidationRegistry\n    participant SB as TALStakingBridgeL2\n    participant L1 as L1 Slashing\n\n    D->>VR: disputeValidation(requestHash, evidence)\n    Note over VR: Status: Completed \u2192 Disputed\n    VR--\x3e>VR: Store evidence on-chain\n\n    Note over VR: DISPUTE_RESOLVER_ROLE reviews evidence\n\n    alt Original validation upheld\n        VR->>VR: resolveDispute(requestHash, true)\n        Note over VR: Status: Disputed \u2192 Completed\n    else Validation overturned\n        VR->>VR: resolveDispute(requestHash, false)\n        VR->>SB: requestSlashing(validator, bountyAmount, evidence)\n        SB->>L1: Relay slash request via CrossDomainMessenger\n        Note over VR: Bounty refunded to requester\n        Note over VR: Status: Disputed \u2192 Expired\n    end"}),"\n",(0,s.jsx)(n.h3,{id:"dispute-rules",children:"Dispute Rules"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Only ",(0,s.jsx)(n.strong,{children:"completed"})," validations can be disputed (not pending or expired)."]}),"\n",(0,s.jsxs)(n.li,{children:["Each validation can have at most ",(0,s.jsx)(n.strong,{children:"one active dispute"})," at a time."]}),"\n",(0,s.jsxs)(n.li,{children:["Evidence bytes ",(0,s.jsx)(n.strong,{children:"must be non-empty"})," -- frivolous disputes without evidence are rejected."]}),"\n",(0,s.jsxs)(n.li,{children:["Resolution requires ",(0,s.jsx)(n.code,{children:"DISPUTE_RESOLVER_ROLE"}),", which should be held by a multisig or governance contract."]}),"\n",(0,s.jsx)(n.li,{children:"If the dispute is upheld (validation overturned), the validator is slashed for the full bounty amount and the bounty is refunded to the requester."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["Dispute resolution is currently centralized via ",(0,s.jsx)(n.code,{children:"DISPUTE_RESOLVER_ROLE"}),". Future governance integration (TALGovernor/TALTimelock) will decentralize this authority."]})}),"\n",(0,s.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"front-running-protection",children:"Front-Running Protection"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Validation requests include a nonce (",(0,s.jsx)(n.code,{children:"_requestNonce++"}),") and ",(0,s.jsx)(n.code,{children:"block.timestamp"})," in the hash, making request IDs unpredictable."]}),"\n",(0,s.jsx)(n.li,{children:"DRB randomness is delivered via callback from the CommitReveal2 coordinator, not derived from on-chain state that miners can manipulate."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"replay-attack-prevention",children:"Replay Attack Prevention"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TALIdentityRegistry"})," uses per-address nonces (",(0,s.jsx)(n.code,{children:"walletNonces"}),") for EIP-712 wallet verification signatures."]}),"\n",(0,s.jsxs)(n.li,{children:["Slash requests include a monotonically increasing nonce (",(0,s.jsx)(n.code,{children:"slashNonce++"}),") to prevent replay."]}),"\n",(0,s.jsx)(n.li,{children:"Validation request hashes include the nonce, timestamp, and sender, ensuring uniqueness."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"reentrancy-protection",children:"Reentrancy Protection"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["All state-changing functions that transfer ETH (bounty distribution, seigniorage claiming, dispute refunds) are protected by OpenZeppelin's ",(0,s.jsx)(n.code,{children:"ReentrancyGuard"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"_distributeBounty"})," function updates state before making external calls (checks-effects-interactions pattern)."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cross-layer-security",children:"Cross-Layer Security"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"L2-to-L1 messages go through Optimism's 7-day finalization period, providing a natural appeal window before slashing executes."}),"\n",(0,s.jsxs)(n.li,{children:["L1 bridge functions validate that ",(0,s.jsx)(n.code,{children:"msg.sender"})," is the ",(0,s.jsx)(n.code,{children:"CrossDomainMessenger"})," and that ",(0,s.jsx)(n.code,{children:"xDomainMessageSender"})," matches the expected counterpart contract."]}),"\n",(0,s.jsxs)(n.li,{children:["See ",(0,s.jsx)(n.a,{href:"/architecture/cross-layer-bridge",children:"Cross-Layer Bridge"})," for the full security model."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>d});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);