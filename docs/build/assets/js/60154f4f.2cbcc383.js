"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[3491],{1707(e,d,i){i.r(d),i.d(d,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"contracts/validation-registry","title":"Validation Registry","description":"The TALValidationRegistry is the multi-model validation engine of the Tokamak AI Layer. It implements ERC-8004 compliant task validation with four trust tiers, DRB-based validator selection, TEE attestation verification, bounty distribution, and a dispute mechanism.","source":"@site/docs/contracts/validation-registry.md","sourceDirName":"contracts","slug":"/contracts/validation-registry","permalink":"/tal/contracts/validation-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/contracts/validation-registry.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Validation Registry","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Reputation Registry","permalink":"/tal/contracts/reputation-registry"},"next":{"title":"Task Fee Escrow","permalink":"/tal/contracts/task-fee-escrow"}}');var s=i(4848),n=i(8453);const r={title:"Validation Registry",sidebar_position:3},l="Validation Registry",c={},a=[{value:"Overview",id:"overview",level:2},{value:"Validation Models",id:"validation-models",level:3},{value:"Validation Lifecycle",id:"validation-lifecycle",level:2},{value:"Bounty Distribution",id:"bounty-distribution",level:2},{value:"Function Reference",id:"function-reference",level:2},{value:"Core Validation",id:"core-validation",level:3},{value:"Validator Selection",id:"validator-selection",level:3},{value:"TEE Attestation Management",id:"tee-attestation-management",level:3},{value:"Dispute Handling",id:"dispute-handling",level:3},{value:"Query Functions",id:"query-functions",level:3},{value:"Admin Functions",id:"admin-functions",level:3},{value:"Events",id:"events",level:2},{value:"Access Control Roles",id:"access-control-roles",level:2},{value:"Constants",id:"constants",level:2},{value:"TEE Attestation Verification",id:"tee-attestation-verification",level:2},{value:"Code Example: Requesting a Validation",id:"code-example-requesting-a-validation",level:2},{value:"Related Pages",id:"related-pages",level:2}];function o(e){const d={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.header,{children:(0,s.jsx)(d.h1,{id:"validation-registry",children:"Validation Registry"})}),"\n",(0,s.jsxs)(d.p,{children:["The ",(0,s.jsx)(d.strong,{children:"TALValidationRegistry"})," is the multi-model validation engine of the Tokamak AI Layer. It implements ERC-8004 compliant task validation with four trust tiers, DRB-based validator selection, TEE attestation verification, bounty distribution, and a dispute mechanism."]}),"\n",(0,s.jsx)(d.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(d.p,{children:"When an AI agent executes a task, how do you know the output is correct? The Validation Registry answers this by providing multiple validation models ranging from lightweight reputation checks to hardware-attested execution verification. Validators are selected fairly using decentralized randomness (Commit-Reveal2), and economic incentives are aligned through bounty distribution."}),"\n",(0,s.jsx)(d.h3,{id:"validation-models",children:"Validation Models"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Model"}),(0,s.jsx)(d.th,{children:"Enum Value"}),(0,s.jsx)(d.th,{children:"Bounty Required"}),(0,s.jsx)(d.th,{children:"Security Level"}),(0,s.jsx)(d.th,{children:"Use Case"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.strong,{children:"ReputationOnly"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"0"})}),(0,s.jsx)(d.td,{children:"None"}),(0,s.jsx)(d.td,{children:"Basic"}),(0,s.jsx)(d.td,{children:"Low-stakes tasks, community feedback"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.strong,{children:"StakeSecured"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"1"})}),(0,s.jsx)(d.td,{children:"10 TON minimum"}),(0,s.jsx)(d.td,{children:"Medium"}),(0,s.jsx)(d.td,{children:"Financial operations, data processing"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.strong,{children:"TEEAttested"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2"})}),(0,s.jsx)(d.td,{children:"1 TON minimum"}),(0,s.jsx)(d.td,{children:"High"}),(0,s.jsx)(d.td,{children:"Sensitive computations, privacy-critical tasks"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.strong,{children:"Hybrid"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"3"})}),(0,s.jsx)(d.td,{children:"max(10, 1) TON"}),(0,s.jsx)(d.td,{children:"Maximum"}),(0,s.jsx)(d.td,{children:"Critical infrastructure, high-value operations"})]})]})]}),"\n",(0,s.jsx)(d.admonition,{title:"Where in the code?",type:"tip",children:(0,s.jsxs)(d.p,{children:[(0,s.jsx)(d.strong,{children:"Contract"}),": ",(0,s.jsx)(d.a,{href:"https://github.com/nicejudy/Tokamak-AI-Layer/blob/master/contracts/src/core/TALValidationRegistry.sol",children:(0,s.jsx)(d.code,{children:"contracts/src/core/TALValidationRegistry.sol"})})," (1052 lines)\n",(0,s.jsx)(d.strong,{children:"Interface"}),": ",(0,s.jsx)(d.a,{href:"https://github.com/nicejudy/Tokamak-AI-Layer/blob/master/contracts/src/interfaces/ITALValidationRegistry.sol",children:(0,s.jsx)(d.code,{children:"contracts/src/interfaces/ITALValidationRegistry.sol"})}),"\n",(0,s.jsx)(d.strong,{children:"SDK Client"}),": ",(0,s.jsx)(d.code,{children:"sdk/src/validation/ValidationClient.ts"})]})}),"\n",(0,s.jsx)(d.h2,{id:"validation-lifecycle",children:"Validation Lifecycle"}),"\n",(0,s.jsx)(d.mermaid,{value:"sequenceDiagram\n    participant R as Requester\n    participant VR as ValidationRegistry\n    participant DRB as DRBIntegrationModule\n    participant V as Validator\n    participant T as Treasury\n\n    R->>VR: requestValidation{value: bounty}(agentId, taskHash, outputHash, model, deadline)\n    VR->>VR: Validate agent, bounty, deadline\n    VR--\x3e>R: requestHash\n\n    Note over VR,DRB: StakeSecured / Hybrid models only\n    VR->>DRB: selectValidator(requestHash, candidates)\n    DRB->>DRB: Commit-Reveal2 randomness\n    DRB--\x3e>VR: selectedValidator\n\n    V->>VR: submitValidation(requestHash, score, proof, detailsURI)\n    VR->>VR: Verify model-specific requirements\n    VR->>VR: Store response, mark Completed\n\n    Note over VR,T: Bounty Distribution\n    VR->>T: 10% protocol fee\n    VR->>R: 9% agent reward (to agent owner)\n    VR->>V: 81% validator reward\n    VR--\x3e>V: emit ValidationCompleted"}),"\n",(0,s.jsx)(d.h2,{id:"bounty-distribution",children:"Bounty Distribution"}),"\n",(0,s.jsx)(d.p,{children:"When a validation is completed with a bounty, funds are distributed as follows:"}),"\n",(0,s.jsx)(d.mermaid,{value:'pie title Bounty Distribution (100 TON example)\n    "Validator (81 TON)" : 81\n    "Protocol Treasury (10 TON)" : 10\n    "Agent Owner (9 TON)" : 9'}),"\n",(0,s.jsx)(d.p,{children:"The exact calculation:"}),"\n",(0,s.jsxs)(d.ol,{children:["\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Protocol fee"}),": ",(0,s.jsx)(d.code,{children:"bounty * protocolFeeBps / 10000"})," = 10% to treasury"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Remaining"}),": ",(0,s.jsx)(d.code,{children:"bounty - protocolFee"})," = 90 TON"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Agent reward"}),": ",(0,s.jsx)(d.code,{children:"remaining * AGENT_REWARD_BPS / 10000"})," = 10% of remaining = 9 TON"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Validator reward"}),": ",(0,s.jsx)(d.code,{children:"remaining - agentReward"})," = 81 TON"]}),"\n"]}),"\n",(0,s.jsx)(d.h2,{id:"function-reference",children:"Function Reference"}),"\n",(0,s.jsx)(d.h3,{id:"core-validation",children:"Core Validation"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Returns"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"requestValidation"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uint256 agentId, bytes32 taskHash, bytes32 outputHash, ValidationModel model, uint256 deadline"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash"})}),(0,s.jsxs)(d.td,{children:["Create a validation request. Send ETH/TON as ",(0,s.jsx)(d.code,{children:"msg.value"})," for bounty. Payable."]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"submitValidation"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash, uint8 score, bytes proof, string detailsURI"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsx)(d.td,{children:"Submit validation result. Score must be 0-100. Model-specific checks apply."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getValidation"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"(ValidationRequest, ValidationResponse)"})}),(0,s.jsx)(d.td,{children:"Retrieve request and response data."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getAgentValidations"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uint256 agentId"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32[]"})}),(0,s.jsx)(d.td,{children:"All validation request hashes for an agent."})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"validator-selection",children:"Validator Selection"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Returns"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"selectValidator"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash, address[] candidates"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsxs)(d.td,{children:["Select a validator via DRB randomness. Restricted to ",(0,s.jsx)(d.code,{children:"DRB_ROLE"}),"."]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getSelectedValidator"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsxs)(d.td,{children:["Get the validator selected for a request. Returns ",(0,s.jsx)(d.code,{children:"address(0)"})," if none."]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"finalizeValidatorSelection"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash, address[] candidates, uint256[] stakes"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsx)(d.td,{children:"Finalize DRB-based selection after Commit-Reveal2 callback delivers randomness."})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"tee-attestation-management",children:"TEE Attestation Management"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Returns"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setTrustedTEEProvider"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address provider"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsxs)(d.td,{children:["Whitelist a TEE attestation provider. ",(0,s.jsx)(d.code,{children:"TEE_MANAGER_ROLE"})," only."]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"removeTrustedTEEProvider"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address provider"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsxs)(d.td,{children:["Remove a provider from the whitelist. ",(0,s.jsx)(d.code,{children:"TEE_MANAGER_ROLE"})," only."]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"isTrustedTEEProvider"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address provider"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bool"})}),(0,s.jsx)(d.td,{children:"Check if a provider is trusted."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getTrustedTEEProviders"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address[]"})}),(0,s.jsx)(d.td,{children:"List all trusted TEE providers."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setTEEEnclaveHash"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address provider, bytes32 enclaveHash"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsxs)(d.td,{children:["Set expected enclave hash for a provider. ",(0,s.jsx)(d.code,{children:"TEE_MANAGER_ROLE"})," only."]})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"dispute-handling",children:"Dispute Handling"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Returns"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"disputeValidation"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash, bytes evidence"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsx)(d.td,{children:"Dispute a completed validation. Authorized for requester, agent owner, or registered validators."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"resolveDispute"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash, bool upholdOriginal"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsxs)(d.td,{children:["Resolve a dispute. ",(0,s.jsx)(d.code,{children:"DISPUTE_RESOLVER_ROLE"})," only. If overturned, validator is slashed and bounty refunded."]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"isDisputed"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 requestHash"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bool"})}),(0,s.jsx)(d.td,{children:"Check if a validation is under dispute."})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"query-functions",children:"Query Functions"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Returns"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getValidationsByRequester"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address requester"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32[]"})}),(0,s.jsx)(d.td,{children:"All validation requests initiated by an address."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getValidationsByValidator"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address validator"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32[]"})}),(0,s.jsx)(d.td,{children:"All validations handled by a validator."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getPendingValidationCount"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uint256 agentId"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uint256"})}),(0,s.jsx)(d.td,{children:"Number of pending validations for an agent."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"getTreasury"})}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:"Current treasury address."})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"admin-functions",children:"Admin Functions"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Access"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsxs)(d.td,{children:[(0,s.jsx)(d.code,{children:"pause"})," / ",(0,s.jsx)(d.code,{children:"unpause"})]}),(0,s.jsx)(d.td,{children:"--"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"PAUSER_ROLE"})}),(0,s.jsx)(d.td,{children:"Emergency pause/unpause."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setTreasury"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update treasury address."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setIdentityRegistry"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update identity registry reference."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setReputationRegistry"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update reputation registry reference."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setStakingBridge"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update staking bridge reference."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setDRBContract"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update DRB contract address."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"setDRBModule"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update DRB integration module address."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"updateValidationParameters"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uint256 minStakeSecuredBounty, uint256 minTEEBounty, uint256 protocolFeeBps"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Update economic parameters."})]})]})]}),"\n",(0,s.jsx)(d.h2,{id:"events",children:"Events"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Event"}),(0,s.jsx)(d.th,{children:"Parameters"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ValidationRequested"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 indexed requestHash, uint256 indexed agentId, ValidationModel model"})}),(0,s.jsx)(d.td,{children:"New validation request created."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ValidationCompleted"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 indexed requestHash, address indexed validator, uint8 score"})}),(0,s.jsx)(d.td,{children:"Validation result submitted."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ValidationDisputed"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 indexed requestHash, address indexed disputer"})}),(0,s.jsx)(d.td,{children:"Dispute initiated."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ValidatorSelected"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 indexed requestHash, address indexed validator, uint256 randomSeed"})}),(0,s.jsx)(d.td,{children:"Validator selected via DRB."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"BountyDistributed"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"bytes32 indexed requestHash, address indexed validator, uint256 validatorAmount, uint256 agentAmount, uint256 treasuryAmount"})}),(0,s.jsx)(d.td,{children:"Bounty split distributed."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"TEEProviderUpdated"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"address indexed provider, bool trusted"})}),(0,s.jsx)(d.td,{children:"TEE provider whitelist changed."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ValidationParametersUpdated"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uint256 minStakeSecuredBounty, uint256 minTEEBounty, uint256 protocolFeeBps"})}),(0,s.jsx)(d.td,{children:"Economic parameters updated."})]})]})]}),"\n",(0,s.jsx)(d.h2,{id:"access-control-roles",children:"Access Control Roles"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Role"}),(0,s.jsx)(d.th,{children:"Purpose"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,s.jsx)(d.td,{children:"Full admin access: manage roles, update references, change parameters"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"UPGRADER_ROLE"})}),(0,s.jsx)(d.td,{children:"Authorize UUPS proxy upgrades"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"PAUSER_ROLE"})}),(0,s.jsx)(d.td,{children:"Pause and unpause the contract"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"TEE_MANAGER_ROLE"})}),(0,s.jsx)(d.td,{children:"Manage trusted TEE providers and enclave hashes"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DISPUTE_RESOLVER_ROLE"})}),(0,s.jsx)(d.td,{children:"Resolve validation disputes"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DRB_ROLE"})}),(0,s.jsx)(d.td,{children:"Execute validator selection via DRB"})]})]})]}),"\n",(0,s.jsx)(d.h2,{id:"constants",children:"Constants"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Constant"}),(0,s.jsx)(d.th,{children:"Value"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"MIN_STAKE_SECURED_BOUNTY"})}),(0,s.jsxs)(d.td,{children:[(0,s.jsx)(d.code,{children:"10 ether"})," (10 TON)"]}),(0,s.jsx)(d.td,{children:"Default minimum bounty for StakeSecured"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"MIN_TEE_BOUNTY"})}),(0,s.jsxs)(d.td,{children:[(0,s.jsx)(d.code,{children:"1 ether"})," (1 TON)"]}),(0,s.jsx)(d.td,{children:"Default minimum bounty for TEEAttested"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"PROTOCOL_FEE_BPS"})}),(0,s.jsxs)(d.td,{children:[(0,s.jsx)(d.code,{children:"1000"})," (10%)"]}),(0,s.jsx)(d.td,{children:"Protocol fee taken from bounty"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"AGENT_REWARD_BPS"})}),(0,s.jsxs)(d.td,{children:[(0,s.jsx)(d.code,{children:"1000"})," (10%)"]}),(0,s.jsx)(d.td,{children:"Agent's share of remaining bounty"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"VALIDATOR_REWARD_BPS"})}),(0,s.jsxs)(d.td,{children:[(0,s.jsx)(d.code,{children:"8000"})," (80%)"]}),(0,s.jsx)(d.td,{children:"Validator's share of remaining bounty"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"MAX_SCORE"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"100"})}),(0,s.jsx)(d.td,{children:"Maximum validation score"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"BPS_DENOMINATOR"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"10000"})}),(0,s.jsx)(d.td,{children:"Basis points denominator"})]})]})]}),"\n",(0,s.jsx)(d.h2,{id:"tee-attestation-verification",children:"TEE Attestation Verification"}),"\n",(0,s.jsxs)(d.p,{children:["For ",(0,s.jsx)(d.code,{children:"TEEAttested"})," and ",(0,s.jsx)(d.code,{children:"Hybrid"})," models, the proof must contain a valid TEE attestation:"]}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-solidity",children:"// Attestation proof structure (ABI-encoded):\n(\n    bytes32 enclaveHash,    // Must match registered hash for provider\n    address teeSigner,      // Must be a trusted TEE provider\n    uint256 timestamp,      // Must be within 1 hour of current time\n    bytes signature         // 65-byte ECDSA signature over (enclaveHash, taskHash, outputHash, requestHash, timestamp)\n)\n"})}),"\n",(0,s.jsx)(d.p,{children:"The verification checks:"}),"\n",(0,s.jsxs)(d.ol,{children:["\n",(0,s.jsx)(d.li,{children:"TEE provider is whitelisted"}),"\n",(0,s.jsx)(d.li,{children:"Enclave hash matches the registered hash for the provider"}),"\n",(0,s.jsx)(d.li,{children:"Attestation is fresh (within 1 hour)"}),"\n",(0,s.jsx)(d.li,{children:"Signature recovers to the TEE provider address"}),"\n"]}),"\n",(0,s.jsx)(d.h2,{id:"code-example-requesting-a-validation",children:"Code Example: Requesting a Validation"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-solidity",children:'// Request a ReputationOnly validation (no bounty needed)\nbytes32 requestHash = validationRegistry.requestValidation(\n    agentId,\n    keccak256(abi.encodePacked(taskInput)),\n    keccak256(abi.encodePacked(taskOutput)),\n    IERC8004ValidationRegistry.ValidationModel.ReputationOnly,\n    block.timestamp + 1 days\n);\n\n// Request a StakeSecured validation with 10 TON bounty\nbytes32 requestHash = validationRegistry.requestValidation{value: 10 ether}(\n    agentId,\n    taskHash,\n    outputHash,\n    IERC8004ValidationRegistry.ValidationModel.StakeSecured,\n    block.timestamp + 1 days\n);\n\n// Submit a validation result\nvalidationRegistry.submitValidation(\n    requestHash,\n    85,                         // score out of 100\n    hex"",                      // proof (empty for ReputationOnly)\n    "ipfs://QmValidationReport" // detailed report URI\n);\n'})}),"\n",(0,s.jsx)(d.admonition,{title:"Dispute Resolution",type:"danger",children:(0,s.jsxs)(d.p,{children:["When a dispute is resolved against the original validation (",(0,s.jsx)(d.code,{children:"upholdOriginal = false"}),"), the validator faces cross-layer slashing via the staking bridge. The bounty is refunded to the requester. This mechanism deters malicious or negligent validation."]})}),"\n",(0,s.jsx)(d.h2,{id:"related-pages",children:"Related Pages"}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.a,{href:"./identity-registry",children:"Identity Registry"})," -- agent existence is validated before accepting requests"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.a,{href:"./reputation-registry",children:"Reputation Registry"})," -- validation results can trigger reputation updates"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.a,{href:"./task-fee-escrow",children:"Task Fee Escrow"})," -- payment layer for task execution"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.a,{href:"./deployment-and-security",children:"Deployment & Security"})," -- proxy patterns, roles, and deployed addresses"]}),"\n"]})]})}function h(e={}){const{wrapper:d}={...(0,n.R)(),...e.components};return d?(0,s.jsx)(d,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,d,i){i.d(d,{R:()=>r,x:()=>l});var t=i(6540);const s={},n=t.createContext(s);function r(e){const d=t.useContext(n);return t.useMemo(function(){return"function"==typeof e?e(d):{...d,...e}},[d,e])}function l(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(n.Provider,{value:d},e.children)}}}]);