"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[5863],{6264(e,t,i){i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"architecture/overview","title":"Architecture Overview","description":"Tokamak AI Layer (TAL) is an ERC-8004 compliant infrastructure layer that provides trustless AI agent discovery, reputation management, and execution verification. The system is deployed across two layers: Ethereum L1 for economic security via TON Staking, and Tokamak L2 (Optimism-based) for low-cost registry operations and validation logic. This split allows TAL to inherit Ethereum\'s security guarantees for staking and slashing while keeping high-frequency operations like feedback submission and validation affordable on L2.","source":"@site/docs/architecture/overview.md","sourceDirName":"architecture","slug":"/architecture/overview","permalink":"/tal/architecture/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/architecture/overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Architecture Overview","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Introduction","permalink":"/tal/"},"next":{"title":"Trust Model","permalink":"/tal/architecture/trust-model"}}');var n=i(4848),s=i(8453);const a={title:"Architecture Overview",sidebar_position:1},d="Architecture Overview",o={},l=[{value:"L1/L2 Architecture Split",id:"l1l2-architecture-split",level:2},{value:"Contract Dependency Graph",id:"contract-dependency-graph",level:2},{value:"Trust Tiers",id:"trust-tiers",level:2},{value:"Data Flows",id:"data-flows",level:2},{value:"Registration Flow",id:"registration-flow",level:3},{value:"Reputation Flow",id:"reputation-flow",level:3},{value:"Validation Flow",id:"validation-flow",level:3},{value:"Cross-Layer Staking Flow",id:"cross-layer-staking-flow",level:3},{value:"Design Patterns",id:"design-patterns",level:2},{value:"Deployed Addresses (Optimism Sepolia)",id:"deployed-addresses-optimism-sepolia",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"architecture-overview",children:"Architecture Overview"})}),"\n",(0,n.jsx)(t.p,{children:"Tokamak AI Layer (TAL) is an ERC-8004 compliant infrastructure layer that provides trustless AI agent discovery, reputation management, and execution verification. The system is deployed across two layers: Ethereum L1 for economic security via TON Staking, and Tokamak L2 (Optimism-based) for low-cost registry operations and validation logic. This split allows TAL to inherit Ethereum's security guarantees for staking and slashing while keeping high-frequency operations like feedback submission and validation affordable on L2."}),"\n",(0,n.jsx)(t.h2,{id:"l1l2-architecture-split",children:"L1/L2 Architecture Split"}),"\n",(0,n.jsx)(t.p,{children:"TAL separates concerns between Ethereum L1 and Tokamak L2 to optimize for both security and cost:"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Ethereum L1"})," handles economic security. Operators stake TON via Staking V2 (SeigManager + DepositManager), and slashing is executed against L1 stake. The 7-day Optimism finalization period acts as a natural appeal window before any slash is finalized."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Tokamak L2"})," handles all registry and validation logic. Agent identity NFTs, reputation aggregation, validation requests, TEE attestation, and bounty distribution all execute on L2 where gas costs are orders of magnitude lower. The L2 contracts maintain a cached view of L1 stake data relayed through the CrossDomainMessenger."]}),"\n",(0,n.jsx)(t.h2,{id:"contract-dependency-graph",children:"Contract Dependency Graph"}),"\n",(0,n.jsx)(t.mermaid,{value:'flowchart TB\n    subgraph L2["Tokamak L2"]\n        VR[TALValidationRegistry]\n        IR[TALIdentityRegistry]\n        RR[TALReputationRegistry]\n        DRB[DRBIntegrationModule]\n        SIM[StakingIntegrationModule]\n        SBL2[TALStakingBridgeL2]\n    end\n\n    subgraph L1["Ethereum L1"]\n        SBL1[TALStakingBridgeL1]\n        SC[TALSlashingConditionsL1]\n        SV2[Staking V2 / SeigManager]\n        DM[DepositManager]\n    end\n\n    VR --\x3e IR\n    VR --\x3e RR\n    VR --\x3e DRB\n    VR --\x3e SBL2\n    SIM --\x3e SBL2\n    IR --\x3e SBL2\n    RR --\x3e SBL2\n\n    SBL2 <--\x3e|CrossDomainMessenger| SBL1\n    SBL1 --\x3e SV2\n    SBL1 --\x3e SC\n    SC --\x3e SV2\n    SC --\x3e DM'}),"\n",(0,n.jsx)(t.admonition,{title:"Where in the code?",type:"tip",children:(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"TALValidationRegistry"}),": ",(0,n.jsx)(t.a,{href:"/contracts/validation-registry",children:(0,n.jsx)(t.code,{children:"contracts/src/core/TALValidationRegistry.sol"})})," (1052 lines)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"TALIdentityRegistry"}),": ",(0,n.jsx)(t.a,{href:"/contracts/identity-registry",children:(0,n.jsx)(t.code,{children:"contracts/src/core/TALIdentityRegistry.sol"})})," (602 lines)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"TALReputationRegistry"}),": ",(0,n.jsx)(t.a,{href:"/contracts/reputation-registry",children:(0,n.jsx)(t.code,{children:"contracts/src/core/TALReputationRegistry.sol"})})," (687 lines)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"DRBIntegrationModule"}),": ",(0,n.jsx)(t.a,{href:"/integration/drb-integration",children:(0,n.jsx)(t.code,{children:"contracts/src/modules/DRBIntegrationModule.sol"})})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"StakingIntegrationModule"}),": ",(0,n.jsx)(t.a,{href:"/integration/staking-bridge",children:(0,n.jsx)(t.code,{children:"contracts/src/modules/StakingIntegrationModule.sol"})})]}),"\n",(0,n.jsxs)(t.li,{children:["Bridge contracts: ",(0,n.jsx)(t.a,{href:"/architecture/cross-layer-bridge",children:(0,n.jsx)(t.code,{children:"contracts/src/bridge/"})})]}),"\n"]})}),"\n",(0,n.jsx)(t.h2,{id:"trust-tiers",children:"Trust Tiers"}),"\n",(0,n.jsx)(t.p,{children:"TAL implements four trust tiers, each providing escalating security guarantees for AI agent validation:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Tier"}),(0,n.jsx)(t.th,{children:"Enum Value"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Security Guarantee"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"ReputationOnly"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"0"})}),(0,n.jsx)(t.td,{children:"Lightweight aggregated feedback scores. Any address can submit a validation. No stake or hardware requirement."}),(0,n.jsxs)(t.td,{children:["Sybil-resistant via stake-weighted reputation math. Feedback values weighted by ",(0,n.jsx)(t.code,{children:"sqrt(stake)"})," to prevent plutocracy."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"StakeSecured"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"1"})}),(0,n.jsx)(t.td,{children:"DRB-selected validator re-executes agent output. Validator must hold >= 1,000 TON on L1. Minimum bounty: 10 TON."}),(0,n.jsx)(t.td,{children:"Economic security through slashable stake. Fraudulent validators lose up to 100% of staked collateral."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"TEEAttested"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"2"})}),(0,n.jsx)(t.td,{children:"Execution verified inside a hardware enclave (SGX, Nitro, TrustZone). TEE provider must be whitelisted. Minimum bounty: 1 TON."}),(0,n.jsx)(t.td,{children:"Hardware-backed integrity guarantee. Failed attestation triggers 50% stake slash."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Hybrid"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"3"})}),(0,n.jsx)(t.td,{children:"Combines StakeSecured and TEEAttested. Both validator selection via DRB and TEE attestation verification are required."}),(0,n.jsx)(t.td,{children:"Maximum security: economic + hardware guarantees. Dual verification path."})]})]})]}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"Trust tiers are set per-validation-request, not per-agent. The same agent can be validated at different tiers depending on the requester's security needs and willingness to pay the bounty."})}),"\n",(0,n.jsx)(t.h2,{id:"data-flows",children:"Data Flows"}),"\n",(0,n.jsx)(t.h3,{id:"registration-flow",children:"Registration Flow"}),"\n",(0,n.jsxs)(t.p,{children:["An agent owner builds a registration file using the SDK's ",(0,n.jsx)(t.code,{children:"RegistrationBuilder"}),", uploads metadata to IPFS, and calls ",(0,n.jsx)(t.code,{children:"TALIdentityRegistry.register(ipfsURI)"}),". The contract mints an ERC-721 identity NFT to the owner. Optionally, a ZK identity commitment (Poseidon hash) can be registered for privacy-preserving capability verification."]}),"\n",(0,n.jsx)(t.h3,{id:"reputation-flow",children:"Reputation Flow"}),"\n",(0,n.jsxs)(t.p,{children:["Clients submit feedback via ",(0,n.jsx)(t.code,{children:"TALReputationRegistry.submitFeedback()"}),", providing a value in the range ",(0,n.jsx)(t.code,{children:"[-100, 100]"}),", tags, and an optional payment proof. Feedback is stored on-chain and aggregated using ",(0,n.jsx)(t.code,{children:"ReputationMath.calculateWeightedAverage()"}),", where each reviewer's weight is ",(0,n.jsx)(t.code,{children:"sqrt(stake)"}),". A Merkle root can be updated off-chain for efficient cross-chain verification."]}),"\n",(0,n.jsx)(t.h3,{id:"validation-flow",children:"Validation Flow"}),"\n",(0,n.jsxs)(t.p,{children:["A requester calls ",(0,n.jsx)(t.code,{children:"TALValidationRegistry.requestValidation()"})," with a bounty, specifying the trust tier. For StakeSecured and Hybrid models, a validator is selected via the DRBIntegrationModule (Commit-Reveal2). The selected validator re-executes the task, submits a score and proof, and the bounty is distributed: 80% to the validator, 10% to the agent owner, 10% to the protocol treasury."]}),"\n",(0,n.jsx)(t.h3,{id:"cross-layer-staking-flow",children:"Cross-Layer Staking Flow"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"TALStakingBridgeL1"})," queries ",(0,n.jsx)(t.code,{children:"SeigManager.stakeOf()"})," on Ethereum L1 and relays the operator's stake amount to ",(0,n.jsx)(t.code,{children:"TALStakingBridgeL2"})," via the Optimism ",(0,n.jsx)(t.code,{children:"CrossDomainMessenger"}),". The L2 bridge caches the snapshot and assigns an operator tier (Unverified, Verified, or Premium). See ",(0,n.jsx)(t.a,{href:"/architecture/cross-layer-bridge",children:"Cross-Layer Bridge"})," for details."]}),"\n",(0,n.jsx)(t.h2,{id:"design-patterns",children:"Design Patterns"}),"\n",(0,n.jsx)(t.p,{children:"All TAL contracts follow consistent design patterns inherited from OpenZeppelin's battle-tested upgradeable library:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Pattern"}),(0,n.jsx)(t.th,{children:"Implementation"}),(0,n.jsx)(t.th,{children:"Purpose"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"UUPS Proxy"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"UUPSUpgradeable"})}),(0,n.jsxs)(t.td,{children:["All core contracts are upgradeable via the Universal Upgradeable Proxy Standard. Upgrade authority is gated by ",(0,n.jsx)(t.code,{children:"UPGRADER_ROLE"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Role-Based Access Control"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"AccessControlUpgradeable"})}),(0,n.jsxs)(t.td,{children:["Granular permissions via named roles: ",(0,n.jsx)(t.code,{children:"UPGRADER_ROLE"}),", ",(0,n.jsx)(t.code,{children:"PAUSER_ROLE"}),", ",(0,n.jsx)(t.code,{children:"TEE_MANAGER_ROLE"}),", ",(0,n.jsx)(t.code,{children:"DRB_ROLE"}),", ",(0,n.jsx)(t.code,{children:"DISPUTE_RESOLVER_ROLE"}),", ",(0,n.jsx)(t.code,{children:"KEEPER_ROLE"}),", ",(0,n.jsx)(t.code,{children:"SLASHER_ROLE"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Storage Gaps"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"uint256[40] private __gap"})}),(0,n.jsx)(t.td,{children:"All upgradeable contracts reserve 28-40 storage slots for future state variables without breaking storage layout."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Reentrancy Guard"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"ReentrancyGuard"})}),(0,n.jsx)(t.td,{children:"Applied to all state-changing external functions that transfer value (feedback submission, bounty distribution, slashing)."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Pausable"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"PausableUpgradeable"})}),(0,n.jsxs)(t.td,{children:["Emergency circuit breaker. ",(0,n.jsx)(t.code,{children:"PAUSER_ROLE"})," holders can halt all state-changing operations instantly."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"EIP-712 Signatures"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"WALLET_VERIFICATION_TYPEHASH"})}),(0,n.jsxs)(t.td,{children:["Used in ",(0,n.jsx)(t.code,{children:"TALIdentityRegistry"})," for replay-protected wallet verification with domain separation."]})]})]})]}),"\n",(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"UPGRADER_ROLE"})," has significant power. In production, this role should be held by a multisig or timelock contract, not an EOA."]})}),"\n",(0,n.jsx)(t.h2,{id:"deployed-addresses-optimism-sepolia",children:"Deployed Addresses (Optimism Sepolia)"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Contract"}),(0,n.jsx)(t.th,{children:"Address"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"TALIdentityRegistry"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"0x3f89CD27fD877827E7665A9883b3c0180E22A525"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"TALReputationRegistry"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"0x0052258E517835081c94c0B685409f2EfC4D502b"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"TALValidationRegistry"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"0x09447147C6E75a60A449f38532F06E19F5F632F3"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"StakingIntegrationModule"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"0x41FF86643f6d550725177af1ABBF4db9715A74b8"})})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"/architecture/trust-model",children:"Trust Model"})," -- deep dive into stake weighting, slashing, and dispute resolution"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"/architecture/cross-layer-bridge",children:"Cross-Layer Bridge"})," -- L1/L2 communication, stake relay, and slashing propagation"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"/contracts/identity-registry",children:"Identity Registry"})," -- ERC-721 agent identities and ZK commitments"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"/contracts/validation-registry",children:"Validation Registry"})," -- validation request lifecycle and bounty mechanics"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453(e,t,i){i.d(t,{R:()=>a,x:()=>d});var r=i(6540);const n={},s=r.createContext(n);function a(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);