"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[8740],{5669(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"contracts/deployment-and-security","title":"Deployment & Security","description":"This page covers the security architecture, deployment patterns, and operational details of the Tokamak AI Layer smart contracts. All core registry contracts use battle-tested OpenZeppelin patterns for upgradeability, access control, and emergency response.","source":"@site/docs/contracts/deployment-and-security.md","sourceDirName":"contracts","slug":"/contracts/deployment-and-security","permalink":"/tal/contracts/deployment-and-security","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/contracts/deployment-and-security.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Deployment & Security","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Task Fee Escrow","permalink":"/tal/contracts/task-fee-escrow"},"next":{"title":"SDK Overview","permalink":"/tal/sdk/overview"}}');var i=t(4848),r=t(8453);const d={title:"Deployment & Security",sidebar_position:5},l="Deployment & Security",c={},a=[{value:"UUPS Proxy Pattern",id:"uups-proxy-pattern",level:2},{value:"Implementation Pattern",id:"implementation-pattern",level:3},{value:"Exception: TaskFeeEscrow",id:"exception-taskfeeescrow",level:3},{value:"Role-Based Access Control",id:"role-based-access-control",level:2},{value:"Storage Gaps",id:"storage-gaps",level:2},{value:"ReentrancyGuard",id:"reentrancyguard",level:2},{value:"Pausable Emergency Mechanism",id:"pausable-emergency-mechanism",level:2},{value:"Deployed Addresses (Optimism Sepolia)",id:"deployed-addresses-optimism-sepolia",level:2},{value:"Gas Benchmarks",id:"gas-benchmarks",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Replay Protection",id:"replay-protection",level:3},{value:"Front-Running Mitigation",id:"front-running-mitigation",level:3},{value:"Reentrancy Protection",id:"reentrancy-protection",level:3},{value:"Access Control",id:"access-control",level:3},{value:"Upgrade Safety",id:"upgrade-safety",level:3},{value:"Self-Feedback Prevention",id:"self-feedback-prevention",level:3},{value:"Value Handling",id:"value-handling",level:3},{value:"Test Coverage",id:"test-coverage",level:2},{value:"Related Pages",id:"related-pages",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"deployment--security",children:"Deployment & Security"})}),"\n",(0,i.jsx)(n.p,{children:"This page covers the security architecture, deployment patterns, and operational details of the Tokamak AI Layer smart contracts. All core registry contracts use battle-tested OpenZeppelin patterns for upgradeability, access control, and emergency response."}),"\n",(0,i.jsx)(n.h2,{id:"uups-proxy-pattern",children:"UUPS Proxy Pattern"}),"\n",(0,i.jsxs)(n.p,{children:["All core registry contracts (Identity, Reputation, Validation) use the ",(0,i.jsx)(n.strong,{children:"UUPS (Universal Upgradeable Proxy Standard)"})," pattern from OpenZeppelin. This means:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["A lightweight ",(0,i.jsx)(n.strong,{children:"ERC1967Proxy"})," holds storage and delegates all calls to an implementation contract"]}),"\n",(0,i.jsxs)(n.li,{children:["The upgrade authorization logic lives in the ",(0,i.jsx)(n.strong,{children:"implementation"})," (not the proxy), reducing proxy gas costs"]}),"\n",(0,i.jsxs)(n.li,{children:["Only addresses with ",(0,i.jsx)(n.code,{children:"UPGRADER_ROLE"})," can authorize upgrades via ",(0,i.jsx)(n.code,{children:"_authorizeUpgrade"})]}),"\n"]}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    U[User] --\x3e|call| P[ERC1967Proxy]\n    P --\x3e|delegatecall| I1[Implementation v1]\n    P -.->|after upgrade| I2[Implementation v2]\n    A[UPGRADER_ROLE] --\x3e|upgradeTo| P"}),"\n",(0,i.jsx)(n.h3,{id:"implementation-pattern",children:"Implementation Pattern"}),"\n",(0,i.jsx)(n.p,{children:"Each upgradeable contract follows this structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'contract TALIdentityRegistry is\n    ERC721Upgradeable,\n    AccessControlUpgradeable,\n    UUPSUpgradeable,\n    PausableUpgradeable,\n    ReentrancyGuard,\n    ITALIdentityRegistry\n{\n    /// @custom:oz-upgrades-unsafe-allow constructor\n    constructor() {\n        _disableInitializers();  // Prevent initialization of implementation\n    }\n\n    function initialize(address admin, ...) public initializer {\n        __ERC721_init("TAL Agent Identity", "TALID");\n        __AccessControl_init();\n        __Pausable_init();\n        // Grant roles, set state...\n    }\n\n    function _authorizeUpgrade(address newImplementation)\n        internal override onlyRole(UPGRADER_ROLE) {}\n\n    // Storage gap for future fields\n    uint256[40] private __gap;\n}\n'})}),"\n",(0,i.jsxs)(n.admonition,{title:"Upgrade Risks",type:"danger",children:[(0,i.jsx)(n.p,{children:"UUPS upgrades are powerful but carry significant risk. A malicious or buggy upgrade can permanently brick the proxy or drain funds. Always ensure:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Multi-sig or timelock controls the ",(0,i.jsx)(n.code,{children:"UPGRADER_ROLE"})]}),"\n",(0,i.jsx)(n.li,{children:"New implementations are thoroughly tested and audited"}),"\n",(0,i.jsx)(n.li,{children:"Storage layout compatibility is verified (no slot collisions)"}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"_authorizeUpgrade"})," function is never removed in new implementations"]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"exception-taskfeeescrow",children:"Exception: TaskFeeEscrow"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"TaskFeeEscrow"})," contract is intentionally ",(0,i.jsx)(n.strong,{children:"non-upgradeable"}),". It handles user funds directly and benefits from the stronger security guarantee of immutable logic. Its ",(0,i.jsx)(n.code,{children:"identityRegistry"})," reference is set at construction time via an ",(0,i.jsx)(n.code,{children:"immutable"})," variable."]}),"\n",(0,i.jsx)(n.h2,{id:"role-based-access-control",children:"Role-Based Access Control"}),"\n",(0,i.jsxs)(n.p,{children:["All core contracts use OpenZeppelin's ",(0,i.jsx)(n.code,{children:"AccessControlUpgradeable"})," with the following role hierarchy:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Role"}),(0,i.jsx)(n.th,{children:"Hash"}),(0,i.jsx)(n.th,{children:"Used In"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0x00"})}),(0,i.jsx)(n.td,{children:"All contracts"}),(0,i.jsx)(n.td,{children:"Grant/revoke other roles, update contract references"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UPGRADER_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("UPGRADER_ROLE")'})}),(0,i.jsx)(n.td,{children:"Identity, Reputation, Validation"}),(0,i.jsx)(n.td,{children:"Authorize UUPS proxy upgrades"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PAUSER_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("PAUSER_ROLE")'})}),(0,i.jsx)(n.td,{children:"Identity, Reputation, Validation"}),(0,i.jsx)(n.td,{children:"Pause and unpause contracts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TEE_MANAGER_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("TEE_MANAGER_ROLE")'})}),(0,i.jsx)(n.td,{children:"Validation"}),(0,i.jsx)(n.td,{children:"Manage trusted TEE providers and enclave hashes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DISPUTE_RESOLVER_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("DISPUTE_RESOLVER_ROLE")'})}),(0,i.jsx)(n.td,{children:"Validation"}),(0,i.jsx)(n.td,{children:"Resolve validation disputes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DRB_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("DRB_ROLE")'})}),(0,i.jsx)(n.td,{children:"Validation"}),(0,i.jsx)(n.td,{children:"Execute DRB-based validator selection"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"MERKLE_UPDATER_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("MERKLE_UPDATER_ROLE")'})}),(0,i.jsx)(n.td,{children:"Reputation"}),(0,i.jsx)(n.td,{children:"Update the reputation Merkle root"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REPUTATION_MANAGER_ROLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'keccak256("REPUTATION_MANAGER_ROLE")'})}),(0,i.jsx)(n.td,{children:"Reputation"}),(0,i.jsx)(n.td,{children:"Update reviewer reputation scores"})]})]})]}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TD\n    A[DEFAULT_ADMIN_ROLE] --\x3e|can grant| B[UPGRADER_ROLE]\n    A --\x3e|can grant| C[PAUSER_ROLE]\n    A --\x3e|can grant| D[TEE_MANAGER_ROLE]\n    A --\x3e|can grant| E[DISPUTE_RESOLVER_ROLE]\n    A --\x3e|can grant| F[DRB_ROLE]\n    A --\x3e|can grant| G[MERKLE_UPDATER_ROLE]\n    A --\x3e|can grant| H[REPUTATION_MANAGER_ROLE]"}),"\n",(0,i.jsx)(n.admonition,{title:"Role Assignment at Initialization",type:"info",children:(0,i.jsxs)(n.p,{children:["During ",(0,i.jsx)(n.code,{children:"initialize()"}),", all roles are granted to the ",(0,i.jsx)(n.code,{children:"admin"})," address. In production, roles should be distributed across different addresses (multi-sig, timelock, service accounts) to implement the principle of least privilege."]})}),"\n",(0,i.jsx)(n.h2,{id:"storage-gaps",children:"Storage Gaps"}),"\n",(0,i.jsx)(n.p,{children:"All upgradeable contracts reserve storage slots for future state variables using the storage gap pattern:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"/// @dev Reserved storage space for future upgrades\nuint256[40] private __gap;\n"})}),"\n",(0,i.jsx)(n.p,{children:"This ensures that when new state variables are added in future implementations, they do not collide with storage slots used by derived contracts. The gap size varies:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Contract"}),(0,i.jsx)(n.th,{children:"Gap Size"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALIdentityRegistry"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uint256[40]"})}),(0,i.jsx)(n.td,{children:"Standard gap"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALReputationRegistry"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uint256[39]"})}),(0,i.jsxs)(n.td,{children:["Slightly reduced (extra state variable ",(0,i.jsx)(n.code,{children:"taskFeeEscrow"})," added)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALValidationRegistry"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uint256[40]"})}),(0,i.jsx)(n.td,{children:"Standard gap"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"reentrancyguard",children:"ReentrancyGuard"}),"\n",(0,i.jsxs)(n.p,{children:["All state-changing external functions that interact with external contracts or transfer value use OpenZeppelin's ",(0,i.jsx)(n.code,{children:"ReentrancyGuard"})," via the ",(0,i.jsx)(n.code,{children:"nonReentrant"})," modifier. Key protected functions include:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TALIdentityRegistry.register()"})," and ",(0,i.jsx)(n.code,{children:"registerWithZKIdentity()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TALReputationRegistry.submitFeedback()"})," and ",(0,i.jsx)(n.code,{children:"submitFeedbackWithPaymentProof()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TALValidationRegistry.requestValidation()"})," and ",(0,i.jsx)(n.code,{children:"submitValidation()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TaskFeeEscrow.payForTask()"}),", ",(0,i.jsx)(n.code,{children:"confirmTask()"}),", ",(0,i.jsx)(n.code,{children:"refundTask()"}),", ",(0,i.jsx)(n.code,{children:"claimFees()"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pausable-emergency-mechanism",children:"Pausable Emergency Mechanism"}),"\n",(0,i.jsxs)(n.p,{children:["All core contracts implement ",(0,i.jsx)(n.code,{children:"PausableUpgradeable"})," with ",(0,i.jsx)(n.code,{children:"whenNotPaused"})," guards on critical functions. When paused:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No new agent registrations"}),"\n",(0,i.jsx)(n.li,{children:"No feedback submissions"}),"\n",(0,i.jsx)(n.li,{children:"No new validation requests or submissions"}),"\n",(0,i.jsx)(n.li,{children:"Read operations (queries, views) remain functional"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"// Pause in an emergency\nidentityRegistry.pause();   // Requires PAUSER_ROLE\n\n// Resume operations\nidentityRegistry.unpause(); // Requires PAUSER_ROLE\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deployed-addresses-optimism-sepolia",children:"Deployed Addresses (Optimism Sepolia)"}),"\n",(0,i.jsxs)(n.p,{children:["The contracts are deployed on Optimism Sepolia (Chain ID: ",(0,i.jsx)(n.code,{children:"11155420"}),") behind ERC1967 proxies:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Contract"}),(0,i.jsx)(n.th,{children:"Proxy Address"}),(0,i.jsx)(n.th,{children:"Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALIdentityRegistry"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0x3f89CD27fD877827E7665A9883b3c0180E22A525"})}),(0,i.jsx)(n.td,{children:"UUPS Proxy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALReputationRegistry"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0x0052258E517835081c94c0B685409f2EfC4D502b"})}),(0,i.jsx)(n.td,{children:"UUPS Proxy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALValidationRegistry"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0x09447147C6E75a60A449f38532F06E19F5F632F3"})}),(0,i.jsx)(n.td,{children:"UUPS Proxy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"StakingIntegrationModule"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0x41FF86643f6d550725177af1ABBF4db9715A74b8"})}),(0,i.jsx)(n.td,{children:"UUPS Proxy"})]})]})]}),"\n",(0,i.jsx)(n.admonition,{title:"Network Configuration",type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network"}),": Optimism Sepolia (testnet)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Chain ID"}),": ",(0,i.jsx)(n.code,{children:"11155420"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Native Token"}),": ETH (Optimism Sepolia uses ETH as gas token)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Standard"}),": ERC-8004 (Trustless Agents Standard)"]}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"gas-benchmarks",children:"Gas Benchmarks"}),"\n",(0,i.jsxs)(n.p,{children:["Gas consumption for key operations, measured from the ",(0,i.jsx)(n.code,{children:"GasBenchmarks.t.sol"})," test suite:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Operation"}),(0,i.jsx)(n.th,{children:"Gas Used"}),(0,i.jsx)(n.th,{children:"Gas Target"}),(0,i.jsx)(n.th,{children:"Status"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"register()"})}),(0,i.jsx)(n.td,{children:"~143,000"}),(0,i.jsx)(n.td,{children:"< 200,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"registerWithZKIdentity()"})}),(0,i.jsx)(n.td,{children:"~165,000"}),(0,i.jsx)(n.td,{children:"< 240,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"updateAgentURI()"})}),(0,i.jsx)(n.td,{children:"~45,000"}),(0,i.jsx)(n.td,{children:"< 100,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"submitFeedback()"})}),(0,i.jsx)(n.td,{children:"~318,000"}),(0,i.jsx)(n.td,{children:"< 350,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"submitFeedbackWithPaymentProof()"})}),(0,i.jsx)(n.td,{children:"~340,000"}),(0,i.jsx)(n.td,{children:"< 455,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"revokeFeedback()"})}),(0,i.jsx)(n.td,{children:"~28,000"}),(0,i.jsx)(n.td,{children:"< 50,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getSummary()"})," (5 clients)"]}),(0,i.jsx)(n.td,{children:"~65,000"}),(0,i.jsx)(n.td,{children:"< 100,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"requestValidation()"})," (ReputationOnly)"]}),(0,i.jsx)(n.td,{children:"~277,000"}),(0,i.jsx)(n.td,{children:"< 300,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"requestValidation()"})," (StakeSecured)"]}),(0,i.jsx)(n.td,{children:"~280,000"}),(0,i.jsx)(n.td,{children:"< 360,000"}),(0,i.jsx)(n.td,{children:"PASS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"submitValidation()"})}),(0,i.jsx)(n.td,{children:"~120,000"}),(0,i.jsx)(n.td,{children:"< 200,000"}),(0,i.jsx)(n.td,{children:"PASS"})]})]})]}),"\n",(0,i.jsxs)(n.admonition,{title:"Running Benchmarks",type:"tip",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd contracts && forge test --match-contract GasBenchmarks -vv\n"})}),(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"-vv"})," flag displays ",(0,i.jsx)(n.code,{children:"console.log"})," output showing exact gas figures."]})]}),"\n",(0,i.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"replay-protection",children:"Replay Protection"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Wallet Verification"}),": Uses EIP-712 typed data signatures with per-wallet nonces (",(0,i.jsx)(n.code,{children:"walletNonces[wallet]++"}),") to prevent signature replay."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation Requests"}),": Each request gets a unique hash derived from ",(0,i.jsx)(n.code,{children:"agentId + sender + taskHash + outputHash + model + deadline + timestamp + nonce"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Task Escrow"}),": Each ",(0,i.jsx)(n.code,{children:"taskRef"})," can only be paid for once (",(0,i.jsx)(n.code,{children:"TaskAlreadyPaid"})," error on duplicate)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"front-running-mitigation",children:"Front-Running Mitigation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DRB Validator Selection"}),": Uses Commit-Reveal2 randomness (when DRB module is configured) instead of predictable blockhash-based selection, making validator assignment manipulation impractical."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TEE Attestation Freshness"}),": Attestations must be within 1 hour of the current block timestamp, limiting the window for attestation replay."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"reentrancy-protection",children:"Reentrancy Protection"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReentrancyGuard"})," applied to all state-changing functions that make external calls or transfer value."]}),"\n",(0,i.jsxs)(n.li,{children:["The Checks-Effects-Interactions pattern is followed: state is updated before external calls are made (e.g., in ",(0,i.jsx)(n.code,{children:"TaskFeeEscrow.claimFees"}),", balance is zeroed before the transfer)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"access-control",children:"Access Control"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All administrative functions are gated behind role checks."}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"DEFAULT_ADMIN_ROLE"})," can grant and revoke all other roles."]}),"\n",(0,i.jsx)(n.li,{children:"Critical operations (upgrades, pausing) require specific roles rather than generic admin access."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"upgrade-safety",children:"Upgrade Safety"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_disableInitializers()"})," in constructors prevents implementation contracts from being initialized directly."]}),"\n",(0,i.jsxs)(n.li,{children:["Storage gaps (",(0,i.jsx)(n.code,{children:"uint256[40] __gap"}),") reserve space for future state variables."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"UPGRADER_ROLE"})," should be protected by a timelock or multi-sig in production deployments."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"self-feedback-prevention",children:"Self-Feedback Prevention"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The Reputation Registry validates that ",(0,i.jsx)(n.code,{children:"ownerOf(agentId) != msg.sender"})," before accepting feedback, preventing agents from inflating their own reputation."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"value-handling",children:"Value Handling"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The Validation Registry includes a ",(0,i.jsx)(n.code,{children:"receive()"})," function to accept bounty payments."]}),"\n",(0,i.jsxs)(n.li,{children:["TaskFeeEscrow requires exact fee matching (",(0,i.jsx)(n.code,{children:"msg.value != fee"})," reverts with ",(0,i.jsx)(n.code,{children:"IncorrectFeeAmount"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Bounty distribution in ValidationRegistry uses checked transfers with ",(0,i.jsx)(n.code,{children:"require(success)"})," to ensure all parties receive their share."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-coverage",children:"Test Coverage"}),"\n",(0,i.jsx)(n.p,{children:"The contract suite includes 384 tests across unit, integration, and benchmark categories:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test Suite"}),(0,i.jsx)(n.th,{children:"Tests"}),(0,i.jsx)(n.th,{children:"Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALIdentityRegistry.t.sol"}),(0,i.jsx)(n.td,{children:"87"}),(0,i.jsx)(n.td,{children:"Unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TALReputationRegistry.t.sol"}),(0,i.jsx)(n.td,{children:"59"}),(0,i.jsx)(n.td,{children:"Unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ReputationMath.t.sol"}),(0,i.jsx)(n.td,{children:"57"}),(0,i.jsx)(n.td,{children:"Unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DRBIntegrationModule.t.sol"}),(0,i.jsx)(n.td,{children:"27"}),(0,i.jsx)(n.td,{children:"Unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"StakingIntegrationModule.t.sol"}),(0,i.jsx)(n.td,{children:"28"}),(0,i.jsx)(n.td,{children:"Unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CrossLayerBridge.t.sol"}),(0,i.jsx)(n.td,{children:"48"}),(0,i.jsx)(n.td,{children:"Integration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"StakeSecuredValidation.t.sol"}),(0,i.jsx)(n.td,{children:"12"}),(0,i.jsx)(n.td,{children:"Integration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TEEAttestedValidation.t.sol"}),(0,i.jsx)(n.td,{children:"20"}),(0,i.jsx)(n.td,{children:"Integration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GasBenchmarks.t.sol"}),(0,i.jsx)(n.td,{children:"11"}),(0,i.jsx)(n.td,{children:"Benchmark"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SDK tests (4 files)"}),(0,i.jsx)(n.td,{children:"35"}),(0,i.jsx)(n.td,{children:"Unit"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run all contract tests\ncd contracts && forge test\n\n# Run with gas report\ncd contracts && forge test --gas-report\n\n# Run specific test suite\ncd contracts && forge test --match-contract TALIdentityRegistry -vvv\n"})}),"\n",(0,i.jsx)(n.h2,{id:"related-pages",children:"Related Pages"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./identity-registry",children:"Identity Registry"})," -- agent registration and identity management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./reputation-registry",children:"Reputation Registry"})," -- feedback and reputation scoring"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./validation-registry",children:"Validation Registry"})," -- multi-model task validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./task-fee-escrow",children:"Task Fee Escrow"})," -- payment escrow for task execution"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>d,x:()=>l});var s=t(6540);const i={},r=s.createContext(i);function d(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);