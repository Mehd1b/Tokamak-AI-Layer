"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[5893],{1717(e,t,n){n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>o,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"contracts/reputation-registry","title":"Reputation Registry","description":"The TALReputationRegistry is the central reputation management system for AI agents on the Tokamak AI Layer. It implements ERC-8004 compliant feedback submission with TAL-specific extensions for stake-weighted aggregation, payment proof integration, and Merkle tree verification.","source":"@site/docs/contracts/reputation-registry.md","sourceDirName":"contracts","slug":"/contracts/reputation-registry","permalink":"/contracts/reputation-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/contracts/reputation-registry.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Reputation Registry","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Identity Registry","permalink":"/contracts/identity-registry"},"next":{"title":"Validation Registry","permalink":"/contracts/validation-registry"}}');var d=n(4848),s=n(8453);const r={title:"Reputation Registry",sidebar_position:2},c="Reputation Registry",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:3},{value:"Feedback Submission Flow",id:"feedback-submission-flow",level:2},{value:"Stake-Weighted Score Calculation",id:"stake-weighted-score-calculation",level:2},{value:"Function Reference",id:"function-reference",level:2},{value:"Feedback Submission",id:"feedback-submission",level:3},{value:"Summary Queries",id:"summary-queries",level:3},{value:"Payment Proofs",id:"payment-proofs",level:3},{value:"Merkle Tree",id:"merkle-tree",level:3},{value:"Reviewer Reputation",id:"reviewer-reputation",level:3},{value:"Query Functions",id:"query-functions",level:3},{value:"Admin Functions",id:"admin-functions",level:3},{value:"Events",id:"events",level:2},{value:"Access Control Roles",id:"access-control-roles",level:2},{value:"ReputationMath Library",id:"reputationmath-library",level:2},{value:"Constants",id:"constants",level:3},{value:"Data Structures",id:"data-structures",level:2},{value:"Feedback",id:"feedback",level:3},{value:"StakeWeightedSummary",id:"stakeweightedsummary",level:3},{value:"Code Example: Submitting Feedback",id:"code-example-submitting-feedback",level:2},{value:"Related Pages",id:"related-pages",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(t.header,{children:(0,d.jsx)(t.h1,{id:"reputation-registry",children:"Reputation Registry"})}),"\n",(0,d.jsxs)(t.p,{children:["The ",(0,d.jsx)(t.strong,{children:"TALReputationRegistry"})," is the central reputation management system for AI agents on the Tokamak AI Layer. It implements ERC-8004 compliant feedback submission with TAL-specific extensions for stake-weighted aggregation, payment proof integration, and Merkle tree verification."]}),"\n",(0,d.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,d.jsx)(t.p,{children:"Reputation in TAL is built from client feedback, weighted by the reviewer's economic stake to prevent Sybil attacks while avoiding plutocracy. The square-root weighting formula ensures that high-stake reviewers have influence proportional to their commitment, but not linearly so."}),"\n",(0,d.jsx)(t.h3,{id:"key-features",children:"Key Features"}),"\n",(0,d.jsxs)(t.ul,{children:["\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"ERC-8004 Compliant Feedback"})," -- structured feedback with tags, URIs, and content hashes"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"Stake-Weighted Aggregation"})," -- feedback weighted by ",(0,d.jsx)(t.code,{children:"sqrt(reviewer_stake)"})," via the ReputationMath library"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"Payment Proof Integration"})," -- higher-trust feedback backed by on-chain payment evidence"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"Merkle Tree Representation"})," -- efficient cross-chain reputation verification"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"Reviewer Reputation Tracking"})," -- meta-reputation for feedback quality weighting"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"Self-Feedback Prevention"})," -- agent owners cannot submit feedback for their own agents"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.strong,{children:"Usage Gating"})," -- optional requirement that reviewers must have completed a task via TaskFeeEscrow"]}),"\n"]}),"\n",(0,d.jsx)(t.admonition,{title:"Where in the code?",type:"tip",children:(0,d.jsxs)(t.p,{children:[(0,d.jsx)(t.strong,{children:"Contract"}),": ",(0,d.jsx)(t.a,{href:"https://github.com/tokamak-network/Tokamak-AI-Layer/blob/master/contracts/src/core/TALReputationRegistry.sol",children:(0,d.jsx)(t.code,{children:"contracts/src/core/TALReputationRegistry.sol"})})," (719 lines)\n",(0,d.jsx)(t.strong,{children:"Library"}),": ",(0,d.jsx)(t.a,{href:"https://github.com/tokamak-network/Tokamak-AI-Layer/blob/master/contracts/src/libraries/ReputationMath.sol",children:(0,d.jsx)(t.code,{children:"contracts/src/libraries/ReputationMath.sol"})})," (138 lines)\n",(0,d.jsx)(t.strong,{children:"SDK Client"}),": ",(0,d.jsx)(t.code,{children:"sdk/src/reputation/ReputationClient.ts"})]})}),"\n",(0,d.jsx)(t.h2,{id:"feedback-submission-flow",children:"Feedback Submission Flow"}),"\n",(0,d.jsx)(t.mermaid,{value:"sequenceDiagram\n    participant C as Client\n    participant RR as ReputationRegistry\n    participant IR as IdentityRegistry\n    participant TFE as TaskFeeEscrow\n    participant RM as ReputationMath\n\n    C->>RR: submitFeedback(agentId, value, tags, ...)\n    RR->>IR: agentExists(agentId)?\n    IR--\x3e>RR: true\n    RR->>IR: ownerOf(agentId) != caller?\n    IR--\x3e>RR: confirmed (not self-feedback)\n    RR->>TFE: hasUsedAgent(agentId, caller)?\n    TFE--\x3e>RR: true (if escrow configured)\n    RR->>RM: normalizeScore(value)\n    RM--\x3e>RR: clamped to [-100, 100]\n    RR->>RR: Store feedback, track client\n    RR--\x3e>C: emit FeedbackSubmitted"}),"\n",(0,d.jsx)(t.h2,{id:"stake-weighted-score-calculation",children:"Stake-Weighted Score Calculation"}),"\n",(0,d.jsx)(t.p,{children:"The TAL reputation system uses a square-root weighting formula to balance economic commitment with fairness:"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{children:"weight(reviewer) = sqrt(stake(reviewer))\nweighted_average = sum(value_i * weight_i) / sum(weight_i)\n"})}),"\n",(0,d.jsx)(t.p,{children:"This approach ensures that a reviewer with 100x more stake only has ~10x more influence, preventing whale domination while still valuing economic commitment."}),"\n",(0,d.jsx)(t.mermaid,{value:"graph LR\n    A[Raw Feedback Values] --\x3e B[ReputationMath.normalizeScore]\n    B --\x3e C[Clamped to -100..100]\n    D[Reviewer Stakes from L2 Bridge] --\x3e E[ReputationMath.calculateStakeWeight]\n    E --\x3e F[sqrt of stake]\n    C --\x3e G[ReputationMath.calculateWeightedAverage]\n    F --\x3e G\n    G --\x3e H[Stake-Weighted Score]"}),"\n",(0,d.jsx)(t.h2,{id:"function-reference",children:"Function Reference"}),"\n",(0,d.jsx)(t.h3,{id:"feedback-submission",children:"Feedback Submission"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"submitFeedback"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, int128 value, uint8 valueDecimals, string tag1, string tag2, string endpoint, string feedbackURI, bytes32 feedbackHash"})}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsx)(t.td,{children:"Submit feedback for an agent. Value is normalized to [-100, 100]. Self-feedback is rejected."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"submitFeedbackWithPaymentProof"})}),(0,d.jsxs)(t.td,{children:["Same as above + ",(0,d.jsx)(t.code,{children:"bytes paymentProof"})]}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsx)(t.td,{children:"Submit feedback with attached payment proof for enhanced trust weighting."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"revokeFeedback"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, uint256 feedbackIndex"})}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsx)(t.td,{children:"Revoke previously submitted feedback. Only the original submitter can revoke."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"respondToFeedback"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address client, uint256 feedbackIndex, string responseURI"})}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsx)(t.td,{children:"Agent owner responds to specific feedback with a URI."})]})]})]}),"\n",(0,d.jsx)(t.h3,{id:"summary-queries",children:"Summary Queries"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getFeedback"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address client"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"Feedback[]"})}),(0,d.jsx)(t.td,{children:"Get all feedback entries from a specific client for an agent."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getSummary"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address[] clients"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"FeedbackSummary"})}),(0,d.jsx)(t.td,{children:"Aggregate non-revoked feedback across specified clients (unweighted)."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getStakeWeightedSummary"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address[] clients"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"StakeWeightedSummary"})}),(0,d.jsxs)(t.td,{children:["Stake-weighted aggregation using ",(0,d.jsx)(t.code,{children:"sqrt(stake)"})," weighting."]})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getVerifiedSummary"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address[] clients"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"FeedbackSummary"})}),(0,d.jsx)(t.td,{children:"Aggregate only payment-proof-backed feedback entries."})]})]})]}),"\n",(0,d.jsx)(t.h3,{id:"payment-proofs",children:"Payment Proofs"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsx)(t.tbody,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"hasPaymentProof"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address client, uint256 feedbackIndex"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"bool"})}),(0,d.jsx)(t.td,{children:"Check if a feedback entry is backed by a payment proof."})]})})]}),"\n",(0,d.jsx)(t.h3,{id:"merkle-tree",children:"Merkle Tree"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getReputationMerkleRoot"})}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"bytes32"})}),(0,d.jsx)(t.td,{children:"Current Merkle root for cross-chain reputation verification."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"updateReputationMerkleRoot"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"bytes32 newRoot"})}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsxs)(t.td,{children:["Update the Merkle root. Restricted to ",(0,d.jsx)(t.code,{children:"MERKLE_UPDATER_ROLE"}),"."]})]})]})]}),"\n",(0,d.jsx)(t.h3,{id:"reviewer-reputation",children:"Reviewer Reputation"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getReviewerReputation"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address reviewer"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256"})}),(0,d.jsx)(t.td,{children:"Get a reviewer's reputation score (0-10000 scale)."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"updateReviewerReputation"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address reviewer, uint256 newReputation"})}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsxs)(t.td,{children:["Update reviewer reputation. Restricted to ",(0,d.jsx)(t.code,{children:"REPUTATION_MANAGER_ROLE"}),"."]})]})]})]}),"\n",(0,d.jsx)(t.h3,{id:"query-functions",children:"Query Functions"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getClientList"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address[]"})}),(0,d.jsx)(t.td,{children:"All unique client addresses that have submitted feedback."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getFeedbackCount"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256"})}),(0,d.jsx)(t.td,{children:"Total feedback count (includes revoked)."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"getResponses"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 agentId, address client, uint256 feedbackIndex"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"string[]"})}),(0,d.jsx)(t.td,{children:"All agent response URIs for a feedback entry."})]})]})]}),"\n",(0,d.jsx)(t.h3,{id:"admin-functions",children:"Admin Functions"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Access"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsxs)(t.td,{children:[(0,d.jsx)(t.code,{children:"pause"})," / ",(0,d.jsx)(t.code,{children:"unpause"})]}),(0,d.jsx)(t.td,{children:"--"}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"PAUSER_ROLE"})}),(0,d.jsx)(t.td,{children:"Emergency pause/unpause."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"setIdentityRegistry"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,d.jsx)(t.td,{children:"Update identity registry reference."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"setStakingBridge"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,d.jsx)(t.td,{children:"Update staking bridge reference."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"setValidationRegistry"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,d.jsx)(t.td,{children:"Update validation registry reference."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"setTaskFeeEscrow"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,d.jsxs)(t.td,{children:["Set escrow address for usage gating. ",(0,d.jsx)(t.code,{children:"address(0)"})," disables the check."]})]})]})]}),"\n",(0,d.jsx)(t.h2,{id:"events",children:"Events"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Event"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"FeedbackSubmitted"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 indexed agentId, address indexed client, int128 value, string tag1, string tag2"})}),(0,d.jsx)(t.td,{children:"Emitted on each feedback submission."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"FeedbackRevoked"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 indexed agentId, address indexed client, uint256 feedbackIndex"})}),(0,d.jsx)(t.td,{children:"Emitted when feedback is revoked."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"ResponseSubmitted"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 indexed agentId, address indexed client, uint256 feedbackIndex"})}),(0,d.jsx)(t.td,{children:"Emitted when the agent owner responds to feedback."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"FeedbackWithPaymentProofSubmitted"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 indexed agentId, address indexed client, int128 value, bytes32 paymentProofHash"})}),(0,d.jsx)(t.td,{children:"Emitted for payment-proof-backed feedback."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"ReputationMerkleRootUpdated"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"bytes32 indexed newRoot, uint256 timestamp"})}),(0,d.jsx)(t.td,{children:"Emitted when the Merkle root is updated."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"ReviewerReputationUpdated"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"address indexed reviewer, uint256 newReputation"})}),(0,d.jsx)(t.td,{children:"Emitted when a reviewer's meta-reputation changes."})]})]})]}),"\n",(0,d.jsx)(t.h2,{id:"access-control-roles",children:"Access Control Roles"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Role"}),(0,d.jsx)(t.th,{children:"Purpose"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,d.jsx)(t.td,{children:"Full admin access: manage roles, update contract references"})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"UPGRADER_ROLE"})}),(0,d.jsx)(t.td,{children:"Authorize UUPS proxy upgrades"})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"PAUSER_ROLE"})}),(0,d.jsx)(t.td,{children:"Pause and unpause the contract"})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"MERKLE_UPDATER_ROLE"})}),(0,d.jsx)(t.td,{children:"Update the reputation Merkle root"})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"REPUTATION_MANAGER_ROLE"})}),(0,d.jsx)(t.td,{children:"Update reviewer reputation scores"})]})]})]}),"\n",(0,d.jsx)(t.h2,{id:"reputationmath-library",children:"ReputationMath Library"}),"\n",(0,d.jsxs)(t.p,{children:["The ",(0,d.jsx)(t.code,{children:"ReputationMath"})," library provides the mathematical primitives used by the registry."]}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Function"}),(0,d.jsx)(t.th,{children:"Parameters"}),(0,d.jsx)(t.th,{children:"Returns"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"normalizeScore"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"int128 score"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"int128"})}),(0,d.jsx)(t.td,{children:"Clamp a score to the range [-100, 100]."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"calculateWeightedAverage"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"int128[] values, uint256[] stakes"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"int256"})}),(0,d.jsxs)(t.td,{children:["Compute stake-weighted average using ",(0,d.jsx)(t.code,{children:"sqrt(stake)"})," weights. Result scaled by ",(0,d.jsx)(t.code,{children:"1e18"}),"."]})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"calculateStakeWeight"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 stake"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256"})}),(0,d.jsxs)(t.td,{children:["Returns ",(0,d.jsx)(t.code,{children:"sqrt(stake)"}),"."]})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"aggregateFeedback"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"int128[] values"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"(int256 total, uint256 count, int128 min, int128 max)"})}),(0,d.jsx)(t.td,{children:"Basic unweighted aggregation."})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"calculateDecay"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 timestamp, uint256 currentTime, uint256 maxAge"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256"})}),(0,d.jsxs)(t.td,{children:["Linear time-decay factor scaled by ",(0,d.jsx)(t.code,{children:"1e18"}),". Returns 0 if older than ",(0,d.jsx)(t.code,{children:"maxAge"}),"."]})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"sqrt"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256 x"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"uint256"})}),(0,d.jsx)(t.td,{children:"Integer square root using the Babylonian method."})]})]})]}),"\n",(0,d.jsx)(t.h3,{id:"constants",children:"Constants"}),"\n",(0,d.jsxs)(t.table,{children:[(0,d.jsx)(t.thead,{children:(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.th,{children:"Constant"}),(0,d.jsx)(t.th,{children:"Value"}),(0,d.jsx)(t.th,{children:"Description"})]})}),(0,d.jsxs)(t.tbody,{children:[(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"PRECISION"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"1e18"})}),(0,d.jsx)(t.td,{children:"Fixed-point precision for calculations"})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"MAX_SCORE"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"100"})}),(0,d.jsx)(t.td,{children:"Maximum allowed feedback value"})]}),(0,d.jsxs)(t.tr,{children:[(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"MIN_SCORE"})}),(0,d.jsx)(t.td,{children:(0,d.jsx)(t.code,{children:"-100"})}),(0,d.jsx)(t.td,{children:"Minimum allowed feedback value"})]})]})]}),"\n",(0,d.jsx)(t.h2,{id:"data-structures",children:"Data Structures"}),"\n",(0,d.jsx)(t.h3,{id:"feedback",children:"Feedback"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-solidity",children:'struct Feedback {\n    int128 value;           // Normalized feedback value [-100, 100]\n    uint8 valueDecimals;    // Decimal places for display\n    string tag1;            // Primary category tag (e.g., "quality")\n    string tag2;            // Secondary category tag (e.g., "speed")\n    string endpoint;        // Service endpoint that was used\n    string feedbackURI;     // URI to detailed feedback content (IPFS)\n    bytes32 feedbackHash;   // Hash of feedback content for integrity\n    bool isRevoked;         // Whether feedback has been revoked\n    uint256 timestamp;      // Block timestamp when submitted\n}\n'})}),"\n",(0,d.jsx)(t.h3,{id:"stakeweightedsummary",children:"StakeWeightedSummary"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-solidity",children:"struct StakeWeightedSummary {\n    int256 weightedTotalValue;  // Sum weighted by sqrt(stake)\n    uint256 totalWeight;        // Sum of all sqrt(stake) weights\n    uint256 count;              // Number of feedbacks included\n    int128 min;                 // Minimum feedback value\n    int128 max;                 // Maximum feedback value\n}\n"})}),"\n",(0,d.jsx)(t.h2,{id:"code-example-submitting-feedback",children:"Code Example: Submitting Feedback"}),"\n",(0,d.jsx)(t.pre,{children:(0,d.jsx)(t.code,{className:"language-solidity",children:'// Submit basic feedback for agent #1\nreputationRegistry.submitFeedback(\n    1,                              // agentId\n    85,                             // value (will be normalized to [-100, 100])\n    2,                              // valueDecimals\n    "accuracy",                     // tag1\n    "latency",                      // tag2\n    "https://agent.example.com/v1", // endpoint\n    "ipfs://QmFeedbackDetails...",  // feedbackURI\n    keccak256("detailed feedback content") // feedbackHash\n);\n\n// Submit feedback backed by a payment proof\nreputationRegistry.submitFeedbackWithPaymentProof(\n    1,                              // agentId\n    90,                             // value\n    2,                              // valueDecimals\n    "quality",                      // tag1\n    "reliability",                  // tag2\n    "https://agent.example.com/v1", // endpoint\n    "ipfs://QmFeedbackDetails...",  // feedbackURI\n    keccak256("feedback content"),  // feedbackHash\n    paymentProofBytes               // payment proof data\n);\n\n// Get stake-weighted summary\naddress[] memory clients = new address[](2);\nclients[0] = reviewer1;\nclients[1] = reviewer2;\nStakeWeightedSummary memory summary = reputationRegistry.getStakeWeightedSummary(1, clients);\n// summary.weightedTotalValue / summary.totalWeight = weighted average\n'})}),"\n",(0,d.jsx)(t.admonition,{title:"Feedback Validation",type:"warning",children:(0,d.jsxs)(t.p,{children:["When ",(0,d.jsx)(t.code,{children:"taskFeeEscrow"})," is configured on the registry, only users who have completed at least one task for the agent (via ",(0,d.jsx)(t.code,{children:"TaskFeeEscrow.confirmTask"}),") can submit feedback. This prevents spam feedback from users who never interacted with the agent."]})}),"\n",(0,d.jsx)(t.h2,{id:"related-pages",children:"Related Pages"}),"\n",(0,d.jsxs)(t.ul,{children:["\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.a,{href:"./identity-registry",children:"Identity Registry"})," -- agent registration required before feedback can be submitted"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.a,{href:"./validation-registry",children:"Validation Registry"})," -- validation results can update reputation"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.a,{href:"./task-fee-escrow",children:"Task Fee Escrow"})," -- payment escrow for usage-gated feedback"]}),"\n",(0,d.jsxs)(t.li,{children:[(0,d.jsx)(t.a,{href:"./deployment-and-security",children:"Deployment & Security"})," -- proxy patterns and deployed addresses"]}),"\n"]})]})}function o(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,d.jsx)(t,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},8453(e,t,n){n.d(t,{R:()=>r,x:()=>c});var i=n(6540);const d={},s=i.createContext(d);function r(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);