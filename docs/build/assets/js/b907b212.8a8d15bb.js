"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[226],{2562(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"integration/ipfs-and-metadata","title":"IPFS & Metadata","description":"TAL stores agent registration files and extended feedback data on IPFS, with only content hashes and URIs stored on-chain. This keeps gas costs low while maintaining verifiability through content addressing.","source":"@site/docs/integration/ipfs-and-metadata.md","sourceDirName":"integration","slug":"/integration/ipfs-and-metadata","permalink":"/tal/integration/ipfs-and-metadata","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/integration/ipfs-and-metadata.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"IPFS & Metadata","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"DRB Integration","permalink":"/tal/integration/drb-integration"},"next":{"title":"Glossary","permalink":"/tal/reference/glossary"}}');var a=t(4848),s=t(8453);const r={title:"IPFS & Metadata",sidebar_position:3},d="IPFS & Metadata",o={},c=[{value:"Upload Flow",id:"upload-flow",level:2},{value:"ERC-8004 Metadata Schema",id:"erc-8004-metadata-schema",level:2},{value:"Required Fields",id:"required-fields",level:3},{value:"Optional Fields",id:"optional-fields",level:3},{value:"Uploading to IPFS",id:"uploading-to-ipfs",level:2},{value:"Using the RegistrationBuilder",id:"using-the-registrationbuilder",level:3},{value:"Using the Frontend API Route",id:"using-the-frontend-api-route",level:3},{value:"Direct Pinata Upload",id:"direct-pinata-upload",level:3},{value:"Multi-Gateway Fetching",id:"multi-gateway-fetching",level:2},{value:"SDK Gateway Configuration",id:"sdk-gateway-configuration",level:3},{value:"Extended Feedback Data",id:"extended-feedback-data",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"ipfs--metadata",children:"IPFS & Metadata"})}),"\n",(0,a.jsx)(n.p,{children:"TAL stores agent registration files and extended feedback data on IPFS, with only content hashes and URIs stored on-chain. This keeps gas costs low while maintaining verifiability through content addressing."}),"\n",(0,a.jsx)(n.h2,{id:"upload-flow",children:"Upload Flow"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant App as Application\n    participant Builder as RegistrationBuilder\n    participant IPFS as IPFS Provider (Pinata/Infura)\n    participant Chain as TALIdentityRegistry\n\n    App->>Builder: setName(), setDescription(), addService(), ...\n    App->>Builder: build()\n    Builder--\x3e>App: AgentRegistrationFile (validated JSON)\n    App->>IPFS: Upload JSON\n    IPFS--\x3e>App: ipfs://QmHash...\n    App->>Chain: register(ipfsUri)\n    Chain--\x3e>App: agentId (ERC-721 NFT)"}),"\n",(0,a.jsx)(n.h2,{id:"erc-8004-metadata-schema",children:"ERC-8004 Metadata Schema"}),"\n",(0,a.jsxs)(n.p,{children:["The registration file follows the ",(0,a.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-8004",children:"ERC-8004"})," standard. Here is a complete example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "type": "https://eips.ethereum.org/EIPS/eip-8004#registration-v1",\n  "name": "Tokamak DeFi Optimizer",\n  "description": "AI agent that optimizes DeFi yield strategies across Tokamak L2 protocols",\n  "image": "https://example.com/agent-avatar.png",\n  "active": true,\n  "services": {\n    "A2A": "https://agent.example.com/.well-known/agent.json",\n    "MCP": "https://agent.example.com/mcp/v1",\n    "OASF": "https://agent.example.com/openapi.yaml",\n    "ENS": "defi-optimizer.eth",\n    "DID": "did:ethr:0x1234567890abcdef1234567890abcdef12345678",\n    "web": "https://agent.example.com"\n  },\n  "supportedTrust": ["reputation", "crypto-economic", "tee-attestation"],\n  "x402Support": true,\n  "registrations": [\n    {\n      "agentId": "1",\n      "agentRegistry": "0x3f89CD27fD877827E7665A9883b3c0180E22A525",\n      "chainId": 11155420\n    }\n  ],\n  "tal": {\n    "capabilities": [\n      {\n        "id": "yield-optimization",\n        "name": "Yield Optimization",\n        "description": "Finds optimal yield farming strategies for a given token",\n        "inputSchema": {\n          "type": "object",\n          "properties": {\n            "token": { "type": "string" },\n            "amount": { "type": "string" },\n            "riskTolerance": { "type": "string", "enum": ["low", "medium", "high"] }\n          },\n          "required": ["token", "amount"]\n        },\n        "outputSchema": {\n          "type": "object",\n          "properties": {\n            "strategy": { "type": "string" },\n            "estimatedApy": { "type": "number" },\n            "protocol": { "type": "string" }\n          }\n        }\n      }\n    ],\n    "operator": {\n      "address": "0xAbCdEf1234567890AbCdEf1234567890AbCdEf12",\n      "organization": "Tokamak Labs",\n      "website": "https://tokamak.network"\n    },\n    "teeConfig": {\n      "provider": "nitro",\n      "enclaveHash": "0xabc123def456...",\n      "attestationEndpoint": "https://agent.example.com/attestation"\n    },\n    "pricing": {\n      "currency": "TON",\n      "perRequest": "0.1",\n      "perToken": "0.001",\n      "subscription": {\n        "monthly": "50",\n        "yearly": "500"\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"required-fields",children:"Required Fields"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Field"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"type"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string"})}),(0,a.jsxs)(n.td,{children:["Must be ",(0,a.jsx)(n.code,{children:"https://eips.ethereum.org/EIPS/eip-8004#registration-v1"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"name"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string"})}),(0,a.jsx)(n.td,{children:"Agent display name"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"description"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string"})}),(0,a.jsx)(n.td,{children:"Agent description"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"active"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"boolean"})}),(0,a.jsx)(n.td,{children:"Whether the agent is active"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"optional-fields",children:"Optional Fields"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Field"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"image"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string"})}),(0,a.jsx)(n.td,{children:"Avatar or logo URL"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"services"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"object"})}),(0,a.jsx)(n.td,{children:"Service endpoint map (A2A, MCP, OASF, ENS, DID, web, email)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"supportedTrust"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"string[]"})}),(0,a.jsxs)(n.td,{children:["Trust models: ",(0,a.jsx)(n.code,{children:"reputation"}),", ",(0,a.jsx)(n.code,{children:"crypto-economic"}),", ",(0,a.jsx)(n.code,{children:"tee-attestation"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"x402Support"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"boolean"})}),(0,a.jsx)(n.td,{children:"Whether the agent supports x402 payments"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"registrations"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"array"})}),(0,a.jsx)(n.td,{children:"Cross-registry registrations"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"tal"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"object"})}),(0,a.jsx)(n.td,{children:"TAL-specific metadata (capabilities, operator, TEE config, pricing)"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"uploading-to-ipfs",children:"Uploading to IPFS"}),"\n",(0,a.jsx)(n.h3,{id:"using-the-registrationbuilder",children:"Using the RegistrationBuilder"}),"\n",(0,a.jsxs)(n.p,{children:["The SDK's ",(0,a.jsx)(n.code,{children:"RegistrationBuilder"})," includes built-in IPFS upload support for Pinata and Infura:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { TALClient } from '@tokamak/tal-sdk';\n\nconst tal = new TALClient({\n  rpcUrl: 'https://sepolia.optimism.io',\n  walletClient,\n});\n\nconst builder = tal.createRegistrationBuilder();\n\nbuilder\n  .setName('My AI Agent')\n  .setDescription('An agent that processes documents')\n  .addService('A2A', 'https://agent.example.com/a2a')\n  .setSupportedTrust(['reputation']);\n\n// Upload to Pinata\nconst ipfsUri = await builder.uploadToIPFS({\n  pinataApiKey: 'your-api-key',\n  pinataSecretKey: 'your-secret-key',\n});\n\nconsole.log(ipfsUri); // ipfs://QmXyz...\n\n// Or upload to Infura\nconst ipfsUri2 = await builder.uploadToIPFS({\n  infuraProjectId: 'your-project-id',\n  infuraProjectSecret: 'your-project-secret',\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"using-the-frontend-api-route",children:"Using the Frontend API Route"}),"\n",(0,a.jsxs)(n.p,{children:["The TAL frontend provides a server-side IPFS upload endpoint at ",(0,a.jsx)(n.code,{children:"/api/ipfs"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const registrationData = {\n  type: 'https://eips.ethereum.org/EIPS/eip-8004#registration-v1',\n  name: 'My AI Agent',\n  description: 'An agent that processes documents',\n  active: true,\n  services: {\n    A2A: 'https://agent.example.com/a2a',\n  },\n};\n\nconst response = await fetch('/api/ipfs', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify(registrationData),\n});\n\nconst { ipfsUri, cid } = await response.json();\nconsole.log(ipfsUri); // ipfs://QmXyz...\nconsole.log(cid);     // QmXyz...\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The API route validates the payload (requires a non-empty ",(0,a.jsx)(n.code,{children:"name"})," field), enforces a 1MB size limit, and uses server-side Pinata credentials configured via ",(0,a.jsx)(n.code,{children:"PINATA_API_KEY"})," and ",(0,a.jsx)(n.code,{children:"PINATA_SECRET_KEY"})," environment variables."]}),"\n",(0,a.jsx)(n.h3,{id:"direct-pinata-upload",children:"Direct Pinata Upload"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"async function uploadToPinata(\n  content: object,\n  apiKey: string,\n  secretKey: string,\n): Promise<string> {\n  const response = await fetch(\n    'https://api.pinata.cloud/pinning/pinJSONToIPFS',\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        pinata_api_key: apiKey,\n        pinata_secret_api_key: secretKey,\n      },\n      body: JSON.stringify({\n        pinataContent: content,\n        pinataMetadata: { name: 'TAL Agent Registration' },\n      }),\n    },\n  );\n\n  if (!response.ok) {\n    throw new Error(`Pinata upload failed: ${response.statusText}`);\n  }\n\n  const data = await response.json();\n  return `ipfs://${data.IpfsHash}`;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"multi-gateway-fetching",children:"Multi-Gateway Fetching"}),"\n",(0,a.jsx)(n.p,{children:"IPFS content is fetched through gateways. Since individual gateways can be unreliable, use a fallback pattern:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const IPFS_GATEWAYS = [\n  'https://gateway.pinata.cloud/ipfs/',\n  'https://ipfs.io/ipfs/',\n  'https://cloudflare-ipfs.com/ipfs/',\n  'https://dweb.link/ipfs/',\n];\n\nasync function fetchFromIPFS(ipfsUri: string): Promise<any> {\n  // Extract CID from ipfs:// URI\n  const cid = ipfsUri.replace('ipfs://', '');\n\n  for (const gateway of IPFS_GATEWAYS) {\n    try {\n      const response = await fetch(`${gateway}${cid}`, {\n        signal: AbortSignal.timeout(10_000), // 10s timeout per gateway\n      });\n\n      if (response.ok) {\n        return await response.json();\n      }\n    } catch {\n      // Try next gateway\n      continue;\n    }\n  }\n\n  throw new Error(`Failed to fetch ${ipfsUri} from all gateways`);\n}\n\n// Usage\nconst registration = await fetchFromIPFS('ipfs://QmXyz...');\nconsole.log(registration.name);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"sdk-gateway-configuration",children:"SDK Gateway Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"TALClient"})," uses a configurable IPFS gateway for fetching registration files:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const tal = new TALClient({\n  rpcUrl: 'https://sepolia.optimism.io',\n  ipfsGateway: 'https://gateway.pinata.cloud/ipfs/', // Custom gateway\n});\n\n// getAgent() automatically fetches and parses the registration file\nconst agent = await tal.getAgent(1n);\nconsole.log(agent.registration?.name); // Parsed from IPFS\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The default gateway is ",(0,a.jsx)(n.code,{children:"https://ipfs.io/ipfs/"}),". Override it with ",(0,a.jsx)(n.code,{children:"ipfsGateway"})," in the client config if you have a preferred or private gateway."]}),"\n",(0,a.jsxs)(n.admonition,{title:"IPFS Pinning and Persistence",type:"warning",children:[(0,a.jsxs)(n.p,{children:["IPFS does ",(0,a.jsx)(n.strong,{children:"not guarantee persistence"}),". If no node is pinning your content, it will eventually be garbage collected and become unavailable. Always ensure your registration files are pinned with a reliable pinning service (Pinata, Infura, Filebase, etc.) or run your own IPFS node with pinning enabled."]}),(0,a.jsx)(n.p,{children:"For production deployments, consider using multiple pinning services for redundancy."})]}),"\n",(0,a.jsx)(n.h2,{id:"extended-feedback-data",children:"Extended Feedback Data"}),"\n",(0,a.jsxs)(n.p,{children:["Detailed feedback data is also stored on IPFS, linked from on-chain feedback entries via the ",(0,a.jsx)(n.code,{children:"feedbackURI"})," field:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import type { ExtendedFeedbackData } from '@tokamak/tal-sdk';\n\nconst feedbackData: ExtendedFeedbackData = {\n  version: '1.0',\n  onChainRef: {\n    agentId: '1',\n    feedbackIndex: 0,\n    txHash: '0xabc123...',\n  },\n  details: {\n    taskDescription: 'Summarize quarterly financial report',\n    inputSummary: '45-page PDF financial report for Q3 2025',\n    outputSummary: '2-page executive summary with key metrics',\n    ratings: {\n      accuracy: 92,\n      speed: 88,\n      reliability: 95,\n      costEfficiency: 80,\n    },\n    review: 'Excellent summarization quality with accurate metric extraction.',\n    attachments: [\n      {\n        type: 'document',\n        uri: 'ipfs://QmOutputDocument...',\n        description: 'Generated summary document',\n      },\n    ],\n  },\n  timestamp: Math.floor(Date.now() / 1000),\n};\n\n// Upload to IPFS\nconst feedbackUri = await uploadToPinata(\n  feedbackData,\n  process.env.PINATA_API_KEY!,\n  process.env.PINATA_SECRET_KEY!,\n);\n\n// Submit feedback with the URI\nawait tal.submitFeedback(1n, {\n  value: 9200,\n  valueDecimals: 2,\n  tag1: 'accuracy',\n  tag2: 'reliability',\n  feedbackURI: feedbackUri,\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../sdk/identity-client",children:"Identity Client"})," -- Full registration workflow with the builder pattern"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../sdk/reputation-and-validation",children:"Reputation & Validation"})," -- Submit feedback with IPFS-linked details"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../sdk/types-reference",children:"Types Reference"})," -- ",(0,a.jsx)(n.code,{children:"AgentRegistrationFile"})," and ",(0,a.jsx)(n.code,{children:"ExtendedFeedbackData"})," type definitions"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>d});var i=t(6540);const a={},s=i.createContext(a);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);