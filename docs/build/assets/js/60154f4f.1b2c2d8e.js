"use strict";(globalThis.webpackChunktal_docs=globalThis.webpackChunktal_docs||[]).push([[3491],{1707(e,t,d){d.r(t),d.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"contracts/validation-registry","title":"Validation Registry","description":"The TALValidationRegistry is the multi-model validation engine of the Tokamak AI Layer. It implements ERC-8004 compliant task validation with three active trust tiers, DRB-based validator selection, TEE attestation verification, bounty distribution, dispute mechanism, epoch-based statistics, dual-staking requirements, and automated slashing via the WSTONVault.","source":"@site/docs/contracts/validation-registry.md","sourceDirName":"contracts","slug":"/contracts/validation-registry","permalink":"/contracts/validation-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/contracts/validation-registry.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Validation Registry","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Reputation Registry","permalink":"/contracts/reputation-registry"},"next":{"title":"WSTON Vault","permalink":"/contracts/wston-vault"}}');var i=d(4848),n=d(8453);const r={title:"Validation Registry",sidebar_position:3},l="Validation Registry",c={},a=[{value:"Overview",id:"overview",level:2},{value:"Validation Models",id:"validation-models",level:3},{value:"V3 Features",id:"v3-features",level:2},{value:"Epoch-Based Statistics (V2)",id:"epoch-based-statistics-v2",level:3},{value:"Dual-Staking Requirement (V3)",id:"dual-staking-requirement-v3",level:3},{value:"Automated Slashing (V3)",id:"automated-slashing-v3",level:3},{value:"WSTONVault Integration (V3)",id:"wstonvault-integration-v3",level:3},{value:"Validation Lifecycle",id:"validation-lifecycle",level:2},{value:"Bounty Distribution",id:"bounty-distribution",level:2},{value:"Function Reference",id:"function-reference",level:2},{value:"Core Validation",id:"core-validation",level:3},{value:"Epoch Stats",id:"epoch-stats",level:3},{value:"Automated Slashing",id:"automated-slashing",level:3},{value:"Validator Selection",id:"validator-selection",level:3},{value:"TEE Attestation Management",id:"tee-attestation-management",level:3},{value:"Dispute Handling",id:"dispute-handling",level:3},{value:"Query Functions",id:"query-functions",level:3},{value:"Admin Functions",id:"admin-functions",level:3},{value:"Events",id:"events",level:2},{value:"Access Control Roles",id:"access-control-roles",level:2},{value:"Constants",id:"constants",level:2},{value:"Storage Layout",id:"storage-layout",level:2},{value:"TEE Attestation Verification",id:"tee-attestation-verification",level:2},{value:"Code Example: Requesting a Validation",id:"code-example-requesting-a-validation",level:2},{value:"Related Pages",id:"related-pages",level:2}];function o(e){const t={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"validation-registry",children:"Validation Registry"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.strong,{children:"TALValidationRegistry"})," is the multi-model validation engine of the Tokamak AI Layer. It implements ERC-8004 compliant task validation with three active trust tiers, DRB-based validator selection, TEE attestation verification, bounty distribution, dispute mechanism, epoch-based statistics, dual-staking requirements, and automated slashing via the WSTONVault."]}),"\n",(0,i.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(t.p,{children:"When an AI agent executes a task, how do you know the output is correct? The Validation Registry answers this by providing multiple validation models with escalating security guarantees. Validators are selected fairly using decentralized randomness (Commit-Reveal2), and economic incentives are aligned through bounty distribution and automated slashing."}),"\n",(0,i.jsx)(t.h3,{id:"validation-models",children:"Validation Models"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Model"}),(0,i.jsx)(t.th,{children:"Enum Value"}),(0,i.jsx)(t.th,{children:"Bounty Required"}),(0,i.jsx)(t.th,{children:"Security Level"}),(0,i.jsx)(t.th,{children:"Use Case"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.del,{children:(0,i.jsx)(t.strong,{children:"ReputationOnly"})})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"0"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.strong,{children:"REJECTED"})," -- the contract reverts if this model is requested"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"StakeSecured"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"1"})}),(0,i.jsx)(t.td,{children:"10 TON minimum"}),(0,i.jsx)(t.td,{children:"Medium"}),(0,i.jsx)(t.td,{children:"Financial operations, data processing"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"TEEAttested"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"2"})}),(0,i.jsx)(t.td,{children:"1 TON minimum"}),(0,i.jsx)(t.td,{children:"High"}),(0,i.jsx)(t.td,{children:"Sensitive computations, privacy-critical tasks"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Hybrid"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"3"})}),(0,i.jsx)(t.td,{children:"max(10, 1) TON"}),(0,i.jsx)(t.td,{children:"Maximum"}),(0,i.jsx)(t.td,{children:"Critical infrastructure, high-value operations"})]})]})]}),"\n",(0,i.jsx)(t.admonition,{title:"ReputationOnly Removed",type:"warning",children:(0,i.jsxs)(t.p,{children:["As of the V3 upgrade, ",(0,i.jsx)(t.code,{children:"ReputationOnly"})," (model ",(0,i.jsx)(t.code,{children:"0"}),") is explicitly ",(0,i.jsx)(t.strong,{children:"rejected"})," by ",(0,i.jsx)(t.code,{children:"requestValidation()"}),". The contract reverts with ",(0,i.jsx)(t.code,{children:"ReputationOnlyNoValidationNeeded()"}),". All validation requests must use StakeSecured, TEEAttested, or Hybrid."]})}),"\n",(0,i.jsx)(t.admonition,{title:"Where in the code?",type:"tip",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Contract"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/tokamak-network/Tokamak-AI-Layer/blob/master/contracts/src/core/TALValidationRegistry.sol",children:(0,i.jsx)(t.code,{children:"contracts/src/core/TALValidationRegistry.sol"})})," (1,112 lines)\n",(0,i.jsx)(t.strong,{children:"Interface"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/tokamak-network/Tokamak-AI-Layer/blob/master/contracts/src/interfaces/ITALValidationRegistry.sol",children:(0,i.jsx)(t.code,{children:"contracts/src/interfaces/ITALValidationRegistry.sol"})}),"\n",(0,i.jsx)(t.strong,{children:"SDK Client"}),": ",(0,i.jsx)(t.code,{children:"sdk/src/validation/ValidationClient.ts"})]})}),"\n",(0,i.jsx)(t.h2,{id:"v3-features",children:"V3 Features"}),"\n",(0,i.jsx)(t.p,{children:"The validation registry has been upgraded through V2 and V3, adding significant new capabilities while maintaining storage compatibility via the UUPS proxy pattern."}),"\n",(0,i.jsx)(t.h3,{id:"epoch-based-statistics-v2",children:"Epoch-Based Statistics (V2)"}),"\n",(0,i.jsx)(t.p,{children:"Validation outcomes are tracked in 30-day epochs. Each validation submission increments per-agent counters:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Total validations"})," per epoch: ",(0,i.jsx)(t.code,{children:"_epochTotalValidations[agentId][epoch]"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Failed validations"})," per epoch (score < 50): ",(0,i.jsx)(t.code,{children:"_epochFailedValidations[agentId][epoch]"})]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:"uint256 public constant EPOCH_DURATION = 30 days;\nuint8 public constant FAILURE_SCORE_THRESHOLD = 50;\n"})}),"\n",(0,i.jsx)(t.p,{children:"Query epoch stats via:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getEpochStats"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 agentId, uint256 epoch"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"(uint256 total, uint256 failed)"})}),(0,i.jsx)(t.td,{children:"Validation counts for a specific epoch"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"currentEpoch"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256"})}),(0,i.jsxs)(t.td,{children:["Current epoch number (",(0,i.jsx)(t.code,{children:"block.timestamp / EPOCH_DURATION"}),")"]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"dual-staking-requirement-v3",children:"Dual-Staking Requirement (V3)"}),"\n",(0,i.jsxs)(t.p,{children:["For ",(0,i.jsx)(t.strong,{children:"StakeSecured"})," and ",(0,i.jsx)(t.strong,{children:"Hybrid"})," models, the agent owner must have at least ",(0,i.jsx)(t.strong,{children:"1,000 TON"})," locked in the WSTONVault. This ensures agents have economic skin-in-the-game, not just the validator."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:"uint256 public constant MIN_AGENT_OWNER_STAKE = 1000 ether;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If the agent owner's locked WSTON is below this threshold, ",(0,i.jsx)(t.code,{children:"requestValidation()"})," reverts with ",(0,i.jsx)(t.code,{children:"InsufficientAgentOwnerStake(owner, currentStake, required)"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"automated-slashing-v3",children:"Automated Slashing (V3)"}),"\n",(0,i.jsx)(t.p,{children:"Two automated slashing mechanisms execute via the WSTONVault without requiring manual dispute resolution:"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"1. Incorrect Computation Slashing"})," -- When a validator submits a score below 50 for a StakeSecured or Hybrid validation, 50% of the ",(0,i.jsx)(t.strong,{children:"agent owner's"})," locked WSTON is automatically slashed:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:"uint8 public constant INCORRECT_COMPUTATION_THRESHOLD = 50;\nuint256 public constant SLASH_INCORRECT_COMPUTATION_PCT = 50;\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"2. Missed Deadline Slashing"})," -- When a StakeSecured/Hybrid validation expires without submission, anyone can call ",(0,i.jsx)(t.code,{children:"slashForMissedDeadline(requestHash)"})," to slash 10% of the ",(0,i.jsx)(t.strong,{children:"selected validator's operator"})," stake and refund the bounty to the requester:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:"uint256 public constant SLASH_MISSED_DEADLINE_PCT = 10;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["This function is ",(0,i.jsx)(t.strong,{children:"permissionless"})," -- any address can trigger it after the deadline passes."]}),"\n",(0,i.jsx)(t.h3,{id:"wstonvault-integration-v3",children:"WSTONVault Integration (V3)"}),"\n",(0,i.jsxs)(t.p,{children:["The validation registry uses the ",(0,i.jsx)(t.a,{href:"./wston-vault",children:"WSTONVault"})," for all stake verification and slashing operations on L2:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Validator stake verification"}),": ",(0,i.jsx)(t.code,{children:"WSTONVault.isVerifiedOperator(validator)"})," -- validators must have locked WSTON above the VERIFIED threshold"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Dual-staking check"}),": ",(0,i.jsx)(t.code,{children:"WSTONVault.getLockedBalance(owner)"})," -- agent owners must meet ",(0,i.jsx)(t.code,{children:"MIN_AGENT_OWNER_STAKE"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Automated slashing"}),": ",(0,i.jsx)(t.code,{children:"WSTONVault.slash(operator, amount)"})," -- seizes locked WSTON and sends it to the treasury"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"validation-lifecycle",children:"Validation Lifecycle"}),"\n",(0,i.jsx)(t.mermaid,{value:"sequenceDiagram\n    participant R as Requester\n    participant VR as ValidationRegistry\n    participant WV as WSTONVault\n    participant DRB as DRBIntegrationModule\n    participant V as Validator\n    participant T as Treasury\n\n    R->>VR: requestValidation{value: bounty}(agentId, taskHash, outputHash, model, deadline)\n    VR->>VR: Reject if ReputationOnly\n    VR->>WV: Check agent owner stake >= 1000 TON (dual-staking)\n    VR--\x3e>R: requestHash\n\n    Note over VR,DRB: StakeSecured / Hybrid models only\n    VR->>DRB: selectValidator(requestHash, candidates)\n    DRB->>DRB: Commit-Reveal2 randomness\n    DRB--\x3e>VR: selectedValidator\n\n    V->>VR: submitValidation(requestHash, score, proof, detailsURI)\n    VR->>WV: Verify validator stake\n    VR->>VR: Record epoch stats\n    alt score < 50 (StakeSecured/Hybrid)\n        VR->>WV: slash(agentOwner, 50% of stake)\n    end\n    VR->>VR: Store response, mark Completed\n\n    Note over VR,T: Bounty Distribution\n    VR->>T: 10% protocol fee\n    VR->>R: 9% agent reward (to agent owner)\n    VR->>V: 81% validator reward\n    VR--\x3e>V: emit ValidationCompleted"}),"\n",(0,i.jsx)(t.h2,{id:"bounty-distribution",children:"Bounty Distribution"}),"\n",(0,i.jsx)(t.p,{children:"When a validation is completed with a bounty, funds are distributed as follows:"}),"\n",(0,i.jsx)(t.mermaid,{value:'pie title Bounty Distribution (100 TON example)\n    "Validator (81 TON)" : 81\n    "Protocol Treasury (10 TON)" : 10\n    "Agent Owner (9 TON)" : 9'}),"\n",(0,i.jsx)(t.p,{children:"The exact calculation:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Protocol fee"}),": ",(0,i.jsx)(t.code,{children:"bounty * protocolFeeBps / 10000"})," = 10% to treasury"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Remaining"}),": ",(0,i.jsx)(t.code,{children:"bounty - protocolFee"})," = 90 TON"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Agent reward"}),": ",(0,i.jsx)(t.code,{children:"remaining * AGENT_REWARD_BPS / 10000"})," = 10% of remaining = 9 TON"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Validator reward"}),": ",(0,i.jsx)(t.code,{children:"remaining - agentReward"})," = 81 TON"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"function-reference",children:"Function Reference"}),"\n",(0,i.jsx)(t.h3,{id:"core-validation",children:"Core Validation"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"requestValidation"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 agentId, bytes32 taskHash, bytes32 outputHash, ValidationModel model, uint256 deadline"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash"})}),(0,i.jsxs)(t.td,{children:["Create a validation request. Reverts for ReputationOnly. Enforces dual-staking for StakeSecured/Hybrid. Send TON as ",(0,i.jsx)(t.code,{children:"msg.value"})," for bounty. Payable."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"submitValidation"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash, uint8 score, bytes proof, string detailsURI"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:"Submit validation result. Score must be 0-100. Records epoch stats. Triggers automated slashing if score < 50."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getValidation"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"(ValidationRequest, ValidationResponse)"})}),(0,i.jsx)(t.td,{children:"Retrieve request and response data."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getAgentValidations"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 agentId"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32[]"})}),(0,i.jsx)(t.td,{children:"All validation request hashes for an agent."})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"epoch-stats",children:"Epoch Stats"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getEpochStats"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 agentId, uint256 epoch"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"(uint256 total, uint256 failed)"})}),(0,i.jsx)(t.td,{children:"Validation counts for a specific epoch."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"currentEpoch"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256"})}),(0,i.jsx)(t.td,{children:"Current epoch number."})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"automated-slashing",children:"Automated Slashing"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"slashForMissedDeadline"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:"Permissionless. Slashes 10% of validator operator stake for expired StakeSecured/Hybrid validations and refunds the bounty to the requester."})]})})]}),"\n",(0,i.jsx)(t.h3,{id:"validator-selection",children:"Validator Selection"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"selectValidator"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash, address[] candidates"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsxs)(t.td,{children:["Select a validator via DRB randomness. Restricted to ",(0,i.jsx)(t.code,{children:"DRB_ROLE"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getSelectedValidator"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsxs)(t.td,{children:["Get the validator selected for a request. Returns ",(0,i.jsx)(t.code,{children:"address(0)"})," if none."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"finalizeValidatorSelection"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash, address[] candidates, uint256[] stakes"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:"Finalize DRB-based selection after Commit-Reveal2 callback delivers randomness."})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"tee-attestation-management",children:"TEE Attestation Management"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setTrustedTEEProvider"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address provider"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsxs)(t.td,{children:["Whitelist a TEE attestation provider. ",(0,i.jsx)(t.code,{children:"TEE_MANAGER_ROLE"})," only."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"removeTrustedTEEProvider"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address provider"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsxs)(t.td,{children:["Remove a provider from the whitelist. ",(0,i.jsx)(t.code,{children:"TEE_MANAGER_ROLE"})," only."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"isTrustedTEEProvider"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address provider"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bool"})}),(0,i.jsx)(t.td,{children:"Check if a provider is trusted."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getTrustedTEEProviders"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address[]"})}),(0,i.jsx)(t.td,{children:"List all trusted TEE providers."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setTEEEnclaveHash"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address provider, bytes32 enclaveHash"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsxs)(t.td,{children:["Set expected enclave hash for a provider. ",(0,i.jsx)(t.code,{children:"TEE_MANAGER_ROLE"})," only."]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"dispute-handling",children:"Dispute Handling"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"disputeValidation"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash, bytes evidence"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:"Dispute a completed validation. Authorized for requester, agent owner, or registered validators."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"resolveDispute"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash, bool upholdOriginal"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsxs)(t.td,{children:["Resolve a dispute. ",(0,i.jsx)(t.code,{children:"DISPUTE_RESOLVER_ROLE"})," only. If overturned, validator is slashed and bounty refunded. Records a dispute failure in epoch stats."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"isDisputed"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 requestHash"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bool"})}),(0,i.jsx)(t.td,{children:"Check if a validation is under dispute."})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"query-functions",children:"Query Functions"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Returns"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getValidationsByRequester"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address requester"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32[]"})}),(0,i.jsx)(t.td,{children:"All validation requests initiated by an address."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getValidationsByValidator"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address validator"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32[]"})}),(0,i.jsx)(t.td,{children:"All validations handled by a validator."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getPendingValidationCount"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 agentId"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256"})}),(0,i.jsx)(t.td,{children:"Number of pending validations for an agent."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getTreasury"})}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsx)(t.td,{children:"Current treasury address."})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"admin-functions",children:"Admin Functions"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Function"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Access"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"pause"})," / ",(0,i.jsx)(t.code,{children:"unpause"})]}),(0,i.jsx)(t.td,{children:"--"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"PAUSER_ROLE"})}),(0,i.jsx)(t.td,{children:"Emergency pause/unpause."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setTreasury"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Update treasury address."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setIdentityRegistry"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Update identity registry reference."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setReputationRegistry"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Update reputation registry reference."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setWSTONVault"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Update WSTONVault reference."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"setDRBModule"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Update DRB integration module address."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"updateValidationParameters"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 minStakeSecuredBounty, uint256 minTEEBounty, uint256 protocolFeeBps"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Update economic parameters."})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"events",children:"Events"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Event"}),(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ValidationRequested"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 indexed requestHash, uint256 indexed agentId, ValidationModel model"})}),(0,i.jsx)(t.td,{children:"New validation request created."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ValidationCompleted"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 indexed requestHash, address indexed validator, uint8 score"})}),(0,i.jsx)(t.td,{children:"Validation result submitted."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ValidationDisputed"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 indexed requestHash, address indexed disputer"})}),(0,i.jsx)(t.td,{children:"Dispute initiated."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ValidatorSelected"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 indexed requestHash, address indexed validator, uint256 randomSeed"})}),(0,i.jsx)(t.td,{children:"Validator selected via DRB."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"BountyDistributed"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 indexed requestHash, address indexed validator, uint256 validatorAmount, uint256 agentAmount, uint256 treasuryAmount"})}),(0,i.jsx)(t.td,{children:"Bounty split distributed."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"TEEProviderUpdated"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"address indexed provider, bool trusted"})}),(0,i.jsx)(t.td,{children:"TEE provider whitelist changed."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ValidationParametersUpdated"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 minStakeSecuredBounty, uint256 minTEEBounty, uint256 protocolFeeBps"})}),(0,i.jsx)(t.td,{children:"Economic parameters updated."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ValidationStatsUpdated"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 indexed agentId, uint256 epoch, uint256 totalInEpoch, uint256 failedInEpoch"})}),(0,i.jsx)(t.td,{children:"Epoch stats updated after validation."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"AgentSlashed"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"uint256 indexed agentId, bytes32 indexed requestHash, uint256 slashAmount, uint256 slashPercentage"})}),(0,i.jsx)(t.td,{children:"Agent owner slashed for incorrect computation."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"OperatorSlashedForDeadline"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"bytes32 indexed requestHash, address indexed operator"})}),(0,i.jsx)(t.td,{children:"Validator operator slashed for missed deadline."})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"access-control-roles",children:"Access Control Roles"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Role"}),(0,i.jsx)(t.th,{children:"Purpose"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DEFAULT_ADMIN_ROLE"})}),(0,i.jsx)(t.td,{children:"Full admin access: manage roles, update references, change parameters"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"UPGRADER_ROLE"})}),(0,i.jsx)(t.td,{children:"Authorize UUPS proxy upgrades"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"PAUSER_ROLE"})}),(0,i.jsx)(t.td,{children:"Pause and unpause the contract"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"TEE_MANAGER_ROLE"})}),(0,i.jsx)(t.td,{children:"Manage trusted TEE providers and enclave hashes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DISPUTE_RESOLVER_ROLE"})}),(0,i.jsx)(t.td,{children:"Resolve validation disputes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"DRB_ROLE"})}),(0,i.jsx)(t.td,{children:"Execute validator selection via DRB"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"constants",children:"Constants"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Constant"}),(0,i.jsx)(t.th,{children:"Value"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MIN_STAKE_SECURED_BOUNTY"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"10 ether"})," (10 TON)"]}),(0,i.jsx)(t.td,{children:"Default minimum bounty for StakeSecured"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MIN_TEE_BOUNTY"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"1 ether"})," (1 TON)"]}),(0,i.jsx)(t.td,{children:"Default minimum bounty for TEEAttested"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"PROTOCOL_FEE_BPS"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"1000"})," (10%)"]}),(0,i.jsx)(t.td,{children:"Protocol fee taken from bounty"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"AGENT_REWARD_BPS"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"1000"})," (10%)"]}),(0,i.jsx)(t.td,{children:"Agent's share of remaining bounty"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"VALIDATOR_REWARD_BPS"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"8000"})," (80%)"]}),(0,i.jsx)(t.td,{children:"Validator's share of remaining bounty"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MAX_SCORE"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"100"})}),(0,i.jsx)(t.td,{children:"Maximum validation score"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"BPS_DENOMINATOR"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"10000"})}),(0,i.jsx)(t.td,{children:"Basis points denominator"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"EPOCH_DURATION"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"30 days"})}),(0,i.jsx)(t.td,{children:"Duration of each stats epoch"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"FAILURE_SCORE_THRESHOLD"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"50"})}),(0,i.jsx)(t.td,{children:'Score below which a validation counts as "failed"'})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MIN_AGENT_OWNER_STAKE"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"1000 ether"})," (1,000 TON)"]}),(0,i.jsx)(t.td,{children:"Minimum agent owner stake for dual-staking"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MIN_OPERATOR_STAKE_V3"})}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.code,{children:"1000 ether"})," (1,000 TON)"]}),(0,i.jsx)(t.td,{children:"Minimum operator stake for validators"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"INCORRECT_COMPUTATION_THRESHOLD"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"50"})}),(0,i.jsx)(t.td,{children:"Score below which incorrect computation slashing triggers"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"SLASH_INCORRECT_COMPUTATION_PCT"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"50"})}),(0,i.jsx)(t.td,{children:"Percentage of agent owner stake slashed for incorrect computation"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"SLASH_MISSED_DEADLINE_PCT"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"10"})}),(0,i.jsx)(t.td,{children:"Percentage of validator stake slashed for missed deadline"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"storage-layout",children:"Storage Layout"}),"\n",(0,i.jsx)(t.p,{children:"The contract uses UUPS proxy pattern with versioned storage gaps:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:"// V1 state variables (identityRegistry, reputationRegistry, drbModule, treasury, mappings...)\nuint256[40] internal __gap;        // V1 gap\n\n// V2 additions: epoch-based stats\nmapping(uint256 => mapping(uint256 => uint256)) internal _epochTotalValidations;\nmapping(uint256 => mapping(uint256 => uint256)) internal _epochFailedValidations;\nuint256[38] private __gapV2;       // V2 gap\n\n// V3 additions: deadline slashing + WSTONVault\nmapping(bytes32 => bool) internal _deadlineSlashExecuted;\naddress public wstonVault;\nuint256[36] private __gapV3;       // V3 gap\n"})}),"\n",(0,i.jsx)(t.h2,{id:"tee-attestation-verification",children:"TEE Attestation Verification"}),"\n",(0,i.jsxs)(t.p,{children:["For ",(0,i.jsx)(t.code,{children:"TEEAttested"})," and ",(0,i.jsx)(t.code,{children:"Hybrid"})," models, the proof must contain a valid TEE attestation:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:"// Attestation proof structure (ABI-encoded):\n(\n    bytes32 enclaveHash,    // Must match registered hash for provider\n    address teeSigner,      // Must be a trusted TEE provider\n    uint256 timestamp,      // Must be within 1 hour of current time\n    bytes signature         // 65-byte ECDSA signature over (enclaveHash, taskHash, outputHash, requestHash, timestamp)\n)\n"})}),"\n",(0,i.jsx)(t.p,{children:"The verification checks:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"TEE provider is whitelisted"}),"\n",(0,i.jsx)(t.li,{children:"Enclave hash matches the registered hash for the provider"}),"\n",(0,i.jsx)(t.li,{children:"Attestation is fresh (within 1 hour)"}),"\n",(0,i.jsx)(t.li,{children:"Signature recovers to the TEE provider address"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"code-example-requesting-a-validation",children:"Code Example: Requesting a Validation"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-solidity",children:'// Request a StakeSecured validation with 10 TON bounty\n// (ReputationOnly is REJECTED -- do not use model 0)\nbytes32 requestHash = validationRegistry.requestValidation{value: 10 ether}(\n    agentId,\n    keccak256(abi.encodePacked(taskInput)),\n    keccak256(abi.encodePacked(taskOutput)),\n    IERC8004ValidationRegistry.ValidationModel.StakeSecured,\n    block.timestamp + 1 days\n);\n\n// Submit a validation result\nvalidationRegistry.submitValidation(\n    requestHash,\n    85,                         // score out of 100\n    hex"",                      // proof (empty for StakeSecured)\n    "ipfs://QmValidationReport" // detailed report URI\n);\n\n// Permissionless deadline slashing (anyone can call after deadline)\nvalidationRegistry.slashForMissedDeadline(expiredRequestHash);\n'})}),"\n",(0,i.jsxs)(t.admonition,{title:"Automated Slashing",type:"danger",children:[(0,i.jsx)(t.p,{children:"Two slashing paths execute automatically without manual dispute resolution:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Incorrect computation"})," (score < 50): 50% of agent owner's WSTON is slashed immediately on ",(0,i.jsx)(t.code,{children:"submitValidation()"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Missed deadline"}),": Anyone can call ",(0,i.jsx)(t.code,{children:"slashForMissedDeadline()"})," to slash 10% of the validator's WSTON and refund the bounty"]}),"\n"]}),(0,i.jsxs)(t.p,{children:["Both operate through the ",(0,i.jsx)(t.a,{href:"./wston-vault",children:"WSTONVault"})," contract on L2."]})]}),"\n",(0,i.jsx)(t.h2,{id:"related-pages",children:"Related Pages"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"./wston-vault",children:"WSTONVault"})," -- L2 WSTON locking, operator tiers, and slashing execution"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"./identity-registry",children:"Identity Registry"})," -- agent existence is validated before accepting requests"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"./reputation-registry",children:"Reputation Registry"})," -- validation results can trigger reputation updates"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"./task-fee-escrow",children:"Task Fee Escrow"})," -- payment layer for task execution"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"./deployment-and-security",children:"Deployment & Security"})," -- proxy patterns, roles, and deployed addresses"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,t,d){d.d(t,{R:()=>r,x:()=>l});var s=d(6540);const i={},n=s.createContext(i);function r(e){const t=s.useContext(n);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);