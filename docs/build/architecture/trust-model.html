<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-architecture/trust-model" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Trust Model | Tokamak AI Layer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.tokamak.network/tal/architecture/trust-model"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Trust Model | Tokamak AI Layer"><meta data-rh="true" name="description" content="TAL&#x27;s trust model is designed around the principle that different use cases require different security guarantees. A low-stakes chatbot lookup needs only reputation feedback, while a DeFi strategy execution requires cryptographic proof of correct computation backed by slashable economic stake. This page covers the security assumptions, mathematical foundations, and enforcement mechanisms behind each trust tier."><meta data-rh="true" property="og:description" content="TAL&#x27;s trust model is designed around the principle that different use cases require different security guarantees. A low-stakes chatbot lookup needs only reputation feedback, while a DeFi strategy execution requires cryptographic proof of correct computation backed by slashable economic stake. This page covers the security assumptions, mathematical foundations, and enforcement mechanisms behind each trust tier."><link data-rh="true" rel="icon" href="/tal/img/logo.svg"><link data-rh="true" rel="canonical" href="https://docs.tokamak.network/tal/architecture/trust-model"><link data-rh="true" rel="alternate" href="https://docs.tokamak.network/tal/architecture/trust-model" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.tokamak.network/tal/architecture/trust-model" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Trust Model","item":"https://docs.tokamak.network/tal/architecture/trust-model"}]}</script><link rel="stylesheet" href="/tal/assets/css/styles.3ab75531.css">
<script src="/tal/assets/js/runtime~main.a1dc9c11.js" defer="defer"></script>
<script src="/tal/assets/js/main.41008321.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/tal/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tal/"><div class="navbar__logo"><img src="/tal/img/logo.svg" alt="TAL Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/tal/img/logo.svg" alt="TAL Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Tokamak AI Layer</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tal/">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/tokamak-network/Tokamak-AI-Layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tal/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/tal/architecture/overview"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/architecture/overview"><span title="Architecture Overview" class="linkLabel_WmDU">Architecture Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tal/architecture/trust-model"><span title="Trust Model" class="linkLabel_WmDU">Trust Model</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/architecture/cross-layer-bridge"><span title="Cross-Layer Bridge" class="linkLabel_WmDU">Cross-Layer Bridge</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/tal/contracts/identity-registry"><span title="Smart Contracts" class="categoryLinkLabel_W154">Smart Contracts</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/contracts/identity-registry"><span title="Identity Registry" class="linkLabel_WmDU">Identity Registry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/contracts/reputation-registry"><span title="Reputation Registry" class="linkLabel_WmDU">Reputation Registry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/contracts/validation-registry"><span title="Validation Registry" class="linkLabel_WmDU">Validation Registry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/contracts/task-fee-escrow"><span title="Task Fee Escrow" class="linkLabel_WmDU">Task Fee Escrow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tal/contracts/deployment-and-security"><span title="Deployment &amp; Security" class="linkLabel_WmDU">Deployment &amp; Security</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tal/sdk/overview"><span title="SDK" class="categoryLinkLabel_W154">SDK</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tal/app/setup"><span title="Frontend App" class="categoryLinkLabel_W154">Frontend App</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tal/integration/staking-bridge"><span title="Integration Guides" class="categoryLinkLabel_W154">Integration Guides</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/tal/reference/glossary"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/tal/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Trust Model</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Trust Model</h1></header>
<p>TAL&#x27;s trust model is designed around the principle that different use cases require different security guarantees. A low-stakes chatbot lookup needs only reputation feedback, while a DeFi strategy execution requires cryptographic proof of correct computation backed by slashable economic stake. This page covers the security assumptions, mathematical foundations, and enforcement mechanisms behind each trust tier.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-assumptions">Security Assumptions<a href="#security-assumptions" class="hash-link" aria-label="Direct link to Security Assumptions" title="Direct link to Security Assumptions" translate="no">​</a></h2>
<p>TAL&#x27;s security rests on three independent pillars, any combination of which can be composed per validation request:</p>
<ol>
<li class=""><strong>Economic security</strong> -- Operators stake TON on Ethereum L1. Misbehavior is punished by slashing, making attacks economically irrational when the stake exceeds the potential gain.</li>
<li class=""><strong>Cryptographic fairness</strong> -- Validator selection uses Tokamak&#x27;s DRB (Decentralized Random Beacon) with the Commit-Reveal2 protocol, producing randomness that is verifiably unbiasable and unpredictable.</li>
<li class=""><strong>Hardware integrity</strong> -- TEE attestation (Intel SGX, AWS Nitro, ARM TrustZone) provides tamper-proof execution guarantees that are independent of economic incentives.</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>No single assumption is relied upon in isolation for high-trust validations. The Hybrid tier combines all three, ensuring that a validator must be economically committed, randomly selected, and hardware-verified.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="stake-weighted-trust">Stake-Weighted Trust<a href="#stake-weighted-trust" class="hash-link" aria-label="Direct link to Stake-Weighted Trust" title="Direct link to Stake-Weighted Trust" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-staked-ton-affects-reputation-weight">How Staked TON Affects Reputation Weight<a href="#how-staked-ton-affects-reputation-weight" class="hash-link" aria-label="Direct link to How Staked TON Affects Reputation Weight" title="Direct link to How Staked TON Affects Reputation Weight" translate="no">​</a></h3>
<p>Reputation feedback is weighted by the reviewer&#x27;s L1 stake using a square root formula. This prevents plutocracy (where large stakers dominate) while still giving skin-in-the-game participants more influence than unstaked reviewers.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// From contracts/src/libraries/ReputationMath.sol</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">calculateWeightedAverage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin" style="color:rgb(189, 147, 249)">int128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">memory</span><span class="token plain"> values</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">memory</span><span class="token plain"> stakes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">internal</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pure</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">int256</span><span class="token plain"> weightedAverage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin" style="color:rgb(189, 147, 249)">int256</span><span class="token plain"> weightedSum </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> totalWeight </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> values</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> weight </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sqrt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">stakes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        weightedSum </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">values</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">weight</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        totalWeight </span><span class="token operator">+=</span><span class="token plain"> weight</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">totalWeight </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">weightedSum </span><span class="token operator">*</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PRECISION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">totalWeight</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>The <code>sqrt()</code> weighting means a reviewer staking 10,000 TON has only 10x the influence of one staking 100 TON (not 100x), making Sybil attacks via stake concentration unprofitable.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="reputationmath-constants">ReputationMath Constants<a href="#reputationmath-constants" class="hash-link" aria-label="Direct link to ReputationMath Constants" title="Direct link to ReputationMath Constants" translate="no">​</a></h3>
<table><thead><tr><th>Constant</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>PRECISION</code></td><td><code>1e18</code></td><td>Fixed-point precision for weighted averages</td></tr><tr><td><code>MAX_SCORE</code></td><td><code>100</code></td><td>Maximum feedback value</td></tr><tr><td><code>MIN_SCORE</code></td><td><code>-100</code></td><td>Minimum feedback value</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="reputation-decay">Reputation Decay<a href="#reputation-decay" class="hash-link" aria-label="Direct link to Reputation Decay" title="Direct link to Reputation Decay" translate="no">​</a></h3>
<p>Feedback loses weight over time via linear decay:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">decayFactor = 1 - (elapsed / maxAge)</span><br></span></code></pre></div></div>
<p>When <code>elapsed &gt;= maxAge</code>, the feedback has zero weight. This ensures reputation reflects recent behavior, not historical performance that may no longer be relevant.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Where in the code?</div><div class="admonitionContent_BuS1"><p>All reputation math functions are in <a class="" href="/tal/contracts/reputation-registry"><code>contracts/src/libraries/ReputationMath.sol</code></a> (138 lines). The library provides <code>calculateWeightedAverage()</code>, <code>calculateStakeWeight()</code>, <code>normalizeScore()</code>, <code>aggregateFeedback()</code>, and <code>calculateDecay()</code>.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="drb-fairness">DRB Fairness<a href="#drb-fairness" class="hash-link" aria-label="Direct link to DRB Fairness" title="Direct link to DRB Fairness" translate="no">​</a></h2>
<p>For StakeSecured and Hybrid validation models, the validator is selected using Tokamak&#x27;s Decentralized Random Beacon (DRB) via the Commit-Reveal2 protocol.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="selection-algorithm">Selection Algorithm<a href="#selection-algorithm" class="hash-link" aria-label="Direct link to Selection Algorithm" title="Direct link to Selection Algorithm" translate="no">​</a></h3>
<!-- -->
<p>The selection uses a cumulative sum approach with stake-based weights:</p>
<ol>
<li class="">Each candidate&#x27;s weight equals their staked TON amount (linear, not square root -- unlike reputation weighting, higher stake means higher selection probability for validators).</li>
<li class="">A cumulative weight array is constructed from the candidates.</li>
<li class="">The DRB random number modulo total weight determines the index.</li>
<li class="">The candidate whose cumulative weight range contains that index is selected.</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>If the DRB module is not configured, the contract falls back to <code>blockhash</code>-based randomness. This is not secure for production -- validators can manipulate block hashes. The DRB module <strong>must</strong> be set for mainnet deployment.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="drb-integration-constants">DRB Integration Constants<a href="#drb-integration-constants" class="hash-link" aria-label="Direct link to DRB Integration Constants" title="Direct link to DRB Integration Constants" translate="no">​</a></h3>
<table><thead><tr><th>Constant</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>DEFAULT_CALLBACK_GAS_LIMIT</code></td><td><code>100,000</code></td><td>Gas limit for the DRB callback</td></tr><tr><td><code>callbackGasLimit</code></td><td>Configurable</td><td>Actual gas limit used per request</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="tee-attestation">TEE Attestation<a href="#tee-attestation" class="hash-link" aria-label="Direct link to TEE Attestation" title="Direct link to TEE Attestation" translate="no">​</a></h2>
<p>TEE (Trusted Execution Environment) attestation provides hardware-backed verification that code executed correctly inside a secure enclave.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-enclave-types">Supported Enclave Types<a href="#supported-enclave-types" class="hash-link" aria-label="Direct link to Supported Enclave Types" title="Direct link to Supported Enclave Types" translate="no">​</a></h3>
<table><thead><tr><th>Enclave</th><th>Provider</th><th>Description</th></tr></thead><tbody><tr><td>Intel SGX</td><td>Intel</td><td>Software Guard Extensions -- isolated memory enclaves on x86 processors</td></tr><tr><td>AWS Nitro</td><td>Amazon</td><td>Nitro Enclaves -- isolated VMs on AWS EC2 with cryptographic attestation</td></tr><tr><td>ARM TrustZone</td><td>ARM</td><td>Hardware isolation on ARM processors, common in mobile/edge devices</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="provider-management">Provider Management<a href="#provider-management" class="hash-link" aria-label="Direct link to Provider Management" title="Direct link to Provider Management" translate="no">​</a></h3>
<p>TEE providers are whitelisted by the <code>TEE_MANAGER_ROLE</code> on <code>TALValidationRegistry</code>. Each provider has an associated enclave hash for verification:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Only TEE_MANAGER_ROLE can add providers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">setTrustedTEEProvider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">external</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">onlyRole</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TEE_MANAGER_ROLE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">removeTrustedTEEProvider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">address</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">external</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">onlyRole</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TEE_MANAGER_ROLE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>When a TEEAttested or Hybrid validation is submitted, the proof bytes are decoded to extract the attestation provider, enclave hash, and signature. The contract verifies the provider is trusted and the attestation is valid.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="slashing-conditions">Slashing Conditions<a href="#slashing-conditions" class="hash-link" aria-label="Direct link to Slashing Conditions" title="Direct link to Slashing Conditions" translate="no">​</a></h2>
<p>Slashing is TAL&#x27;s enforcement mechanism. When misbehavior is detected on L2, a slash request is relayed to L1 where it executes against the operator&#x27;s staked TON via <code>DepositManager.slash()</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="severity-levels">Severity Levels<a href="#severity-levels" class="hash-link" aria-label="Direct link to Severity Levels" title="Direct link to Severity Levels" translate="no">​</a></h3>
<table><thead><tr><th>Condition</th><th>Slash %</th><th>Trigger</th><th>Threshold</th></tr></thead><tbody><tr><td><strong>Failed TEE Attestation</strong></td><td>50%</td><td>TEE attestation verification fails for a submitted validation</td><td>Automatic on proof failure</td></tr><tr><td><strong>Proven Validator Fraud</strong></td><td>100%</td><td>Validator provably submitted false validation results</td><td>Dispute resolution upholds challenger</td></tr><tr><td><strong>Repeated Low Reputation</strong></td><td>25%</td><td>Operator&#x27;s aggregate reputation falls below threshold</td><td>Reputation score &lt; <code>-50</code></td></tr><tr><td><strong>DAO Adjudicated</strong></td><td>Variable (0-100%)</td><td>Governance vote determines severity for edge cases</td><td>Custom percentage set by governance</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Proven fraud results in 100% stake loss. There is no partial forgiveness for deliberate falsification of validation results.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="slash-calculation">Slash Calculation<a href="#slash-calculation" class="hash-link" aria-label="Direct link to Slash Calculation" title="Direct link to Slash Calculation" translate="no">​</a></h3>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// From contracts/src/libraries/SlashingCalculator.sol</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">calculateSlashAmount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">SlashParams </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">memory</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">internal</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> slashAmount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> percentage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">operatorStake </span><span class="token operator">&lt;</span><span class="token plain"> MIN_SLASHABLE_STAKE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Dust threshold: &lt; 1 TON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    percentage </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getSlashPercentage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">reason</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">customPercentage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    slashAmount </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">operatorStake </span><span class="token operator">*</span><span class="token plain"> percentage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cumulative-slashing">Cumulative Slashing<a href="#cumulative-slashing" class="hash-link" aria-label="Direct link to Cumulative Slashing" title="Direct link to Cumulative Slashing" translate="no">​</a></h3>
<p>Multiple offenses are applied sequentially -- each slash reduces the remaining stake before the next is calculated:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">calculateCumulativeSlash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> stake</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">memory</span><span class="token plain"> percentages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">internal</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pure</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> totalSlashed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> remainingStake</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    remainingStake </span><span class="token operator">=</span><span class="token plain"> stake</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> percentages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(189, 147, 249)">uint256</span><span class="token plain"> slashAmount </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">remainingStake </span><span class="token operator">*</span><span class="token plain"> pct</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        totalSlashed </span><span class="token operator">+=</span><span class="token plain"> slashAmount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        remainingStake </span><span class="token operator">-=</span><span class="token plain"> slashAmount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>For example, an operator with 10,000 TON who receives a 50% slash (TEE failure) followed by a 25% slash (low reputation) loses 5,000 + 1,250 = 6,250 TON, retaining 3,750 TON.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="slashingcalculator-constants">SlashingCalculator Constants<a href="#slashingcalculator-constants" class="hash-link" aria-label="Direct link to SlashingCalculator Constants" title="Direct link to SlashingCalculator Constants" translate="no">​</a></h3>
<table><thead><tr><th>Constant</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>SLASH_FAILED_TEE</code></td><td><code>50</code></td><td>Percentage slashed for failed TEE attestation</td></tr><tr><td><code>SLASH_PROVEN_FRAUD</code></td><td><code>100</code></td><td>Percentage slashed for proven fraud</td></tr><tr><td><code>SLASH_LOW_REPUTATION</code></td><td><code>25</code></td><td>Percentage slashed for low reputation</td></tr><tr><td><code>MAX_SLASH_PERCENTAGE</code></td><td><code>100</code></td><td>Maximum slash percentage cap</td></tr><tr><td><code>MIN_SLASHABLE_STAKE</code></td><td><code>1 ether</code></td><td>Minimum stake below which slashing is skipped</td></tr><tr><td><code>LOW_REPUTATION_THRESHOLD</code></td><td><code>-50</code></td><td>Reputation score below which low-rep slashing triggers</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Where in the code?</div><div class="admonitionContent_BuS1"><p>Slashing math is in <code>contracts/src/libraries/SlashingCalculator.sol</code> (162 lines). Cross-layer slashing execution is in <a class="" href="/tal/architecture/cross-layer-bridge"><code>contracts/src/bridge/TALSlashingConditionsL1.sol</code></a>.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="bounty-distribution">Bounty Distribution<a href="#bounty-distribution" class="hash-link" aria-label="Direct link to Bounty Distribution" title="Direct link to Bounty Distribution" translate="no">​</a></h2>
<p>When a validation is completed, the bounty attached to the request is distributed among three parties:</p>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="distribution-constants">Distribution Constants<a href="#distribution-constants" class="hash-link" aria-label="Direct link to Distribution Constants" title="Direct link to Distribution Constants" translate="no">​</a></h3>
<table><thead><tr><th>Constant</th><th>Value (BPS)</th><th>Effective %</th><th>Recipient</th></tr></thead><tbody><tr><td><code>PROTOCOL_FEE_BPS</code></td><td><code>1000</code></td><td>10% of total bounty</td><td>Protocol treasury</td></tr><tr><td><code>AGENT_REWARD_BPS</code></td><td><code>1000</code></td><td>10% of remaining (9% of total)</td><td>Agent NFT owner</td></tr><tr><td><code>VALIDATOR_REWARD_BPS</code></td><td><code>8000</code></td><td>80% of remaining (72% of total)</td><td>Validator who submitted result</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="concrete-example">Concrete Example<a href="#concrete-example" class="hash-link" aria-label="Direct link to Concrete Example" title="Direct link to Concrete Example" translate="no">​</a></h3>
<p>For a 10 TON bounty:</p>
<ol>
<li class="">Treasury receives: 10 * 10% = <strong>1 TON</strong></li>
<li class="">Remaining: 10 - 1 = <strong>9 TON</strong></li>
<li class="">Agent owner receives: 9 * 10% = <strong>0.9 TON</strong></li>
<li class="">Validator receives: 9 - 0.9 = <strong>8.1 TON</strong></li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="minimum-bounty-requirements">Minimum Bounty Requirements<a href="#minimum-bounty-requirements" class="hash-link" aria-label="Direct link to Minimum Bounty Requirements" title="Direct link to Minimum Bounty Requirements" translate="no">​</a></h3>
<table><thead><tr><th>Validation Model</th><th>Minimum Bounty</th></tr></thead><tbody><tr><td>ReputationOnly</td><td>0 (no bounty required)</td></tr><tr><td>StakeSecured</td><td>10 TON (<code>MIN_STAKE_SECURED_BOUNTY</code>)</td></tr><tr><td>TEEAttested</td><td>1 TON (<code>MIN_TEE_BOUNTY</code>)</td></tr><tr><td>Hybrid</td><td>10 TON (uses StakeSecured minimum)</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="dispute-mechanism">Dispute Mechanism<a href="#dispute-mechanism" class="hash-link" aria-label="Direct link to Dispute Mechanism" title="Direct link to Dispute Mechanism" translate="no">​</a></h2>
<p>Any completed validation can be challenged through the dispute process.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="who-can-dispute">Who Can Dispute<a href="#who-can-dispute" class="hash-link" aria-label="Direct link to Who Can Dispute" title="Direct link to Who Can Dispute" translate="no">​</a></h3>
<ul>
<li class="">The <strong>original requester</strong> who paid for the validation</li>
<li class="">The <strong>agent owner</strong> (NFT holder)</li>
<li class="">Any <strong>registered validator</strong> (anyone with validation submission history)</li>
<li class="">The <strong>selected validator</strong> for the specific request</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dispute-flow">Dispute Flow<a href="#dispute-flow" class="hash-link" aria-label="Direct link to Dispute Flow" title="Direct link to Dispute Flow" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dispute-rules">Dispute Rules<a href="#dispute-rules" class="hash-link" aria-label="Direct link to Dispute Rules" title="Direct link to Dispute Rules" translate="no">​</a></h3>
<ol>
<li class="">Only <strong>completed</strong> validations can be disputed (not pending or expired).</li>
<li class="">Each validation can have at most <strong>one active dispute</strong> at a time.</li>
<li class="">Evidence bytes <strong>must be non-empty</strong> -- frivolous disputes without evidence are rejected.</li>
<li class="">Resolution requires <code>DISPUTE_RESOLVER_ROLE</code>, which should be held by a multisig or governance contract.</li>
<li class="">If the dispute is upheld (validation overturned), the validator is slashed for the full bounty amount and the bounty is refunded to the requester.</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Dispute resolution is currently centralized via <code>DISPUTE_RESOLVER_ROLE</code>. Future governance integration (TALGovernor/TALTimelock) will decentralize this authority.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="front-running-protection">Front-Running Protection<a href="#front-running-protection" class="hash-link" aria-label="Direct link to Front-Running Protection" title="Direct link to Front-Running Protection" translate="no">​</a></h3>
<ul>
<li class="">Validation requests include a nonce (<code>_requestNonce++</code>) and <code>block.timestamp</code> in the hash, making request IDs unpredictable.</li>
<li class="">DRB randomness is delivered via callback from the CommitReveal2 coordinator, not derived from on-chain state that miners can manipulate.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="replay-attack-prevention">Replay Attack Prevention<a href="#replay-attack-prevention" class="hash-link" aria-label="Direct link to Replay Attack Prevention" title="Direct link to Replay Attack Prevention" translate="no">​</a></h3>
<ul>
<li class=""><code>TALIdentityRegistry</code> uses per-address nonces (<code>walletNonces</code>) for EIP-712 wallet verification signatures.</li>
<li class="">Slash requests include a monotonically increasing nonce (<code>slashNonce++</code>) to prevent replay.</li>
<li class="">Validation request hashes include the nonce, timestamp, and sender, ensuring uniqueness.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="reentrancy-protection">Reentrancy Protection<a href="#reentrancy-protection" class="hash-link" aria-label="Direct link to Reentrancy Protection" title="Direct link to Reentrancy Protection" translate="no">​</a></h3>
<ul>
<li class="">All state-changing functions that transfer ETH (bounty distribution, seigniorage claiming, dispute refunds) are protected by OpenZeppelin&#x27;s <code>ReentrancyGuard</code>.</li>
<li class="">The <code>_distributeBounty</code> function updates state before making external calls (checks-effects-interactions pattern).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cross-layer-security">Cross-Layer Security<a href="#cross-layer-security" class="hash-link" aria-label="Direct link to Cross-Layer Security" title="Direct link to Cross-Layer Security" translate="no">​</a></h3>
<ul>
<li class="">L2-to-L1 messages go through Optimism&#x27;s 7-day finalization period, providing a natural appeal window before slashing executes.</li>
<li class="">L1 bridge functions validate that <code>msg.sender</code> is the <code>CrossDomainMessenger</code> and that <code>xDomainMessageSender</code> matches the expected counterpart contract.</li>
<li class="">See <a class="" href="/tal/architecture/cross-layer-bridge">Cross-Layer Bridge</a> for the full security model.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/tokamak-network/Tokamak-AI-Layer/tree/master/docs/docs/architecture/trust-model.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/tal/architecture/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Architecture Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tal/architecture/cross-layer-bridge"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cross-Layer Bridge</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#security-assumptions" class="table-of-contents__link toc-highlight">Security Assumptions</a></li><li><a href="#stake-weighted-trust" class="table-of-contents__link toc-highlight">Stake-Weighted Trust</a><ul><li><a href="#how-staked-ton-affects-reputation-weight" class="table-of-contents__link toc-highlight">How Staked TON Affects Reputation Weight</a></li><li><a href="#reputationmath-constants" class="table-of-contents__link toc-highlight">ReputationMath Constants</a></li><li><a href="#reputation-decay" class="table-of-contents__link toc-highlight">Reputation Decay</a></li></ul></li><li><a href="#drb-fairness" class="table-of-contents__link toc-highlight">DRB Fairness</a><ul><li><a href="#selection-algorithm" class="table-of-contents__link toc-highlight">Selection Algorithm</a></li><li><a href="#drb-integration-constants" class="table-of-contents__link toc-highlight">DRB Integration Constants</a></li></ul></li><li><a href="#tee-attestation" class="table-of-contents__link toc-highlight">TEE Attestation</a><ul><li><a href="#supported-enclave-types" class="table-of-contents__link toc-highlight">Supported Enclave Types</a></li><li><a href="#provider-management" class="table-of-contents__link toc-highlight">Provider Management</a></li></ul></li><li><a href="#slashing-conditions" class="table-of-contents__link toc-highlight">Slashing Conditions</a><ul><li><a href="#severity-levels" class="table-of-contents__link toc-highlight">Severity Levels</a></li><li><a href="#slash-calculation" class="table-of-contents__link toc-highlight">Slash Calculation</a></li><li><a href="#cumulative-slashing" class="table-of-contents__link toc-highlight">Cumulative Slashing</a></li><li><a href="#slashingcalculator-constants" class="table-of-contents__link toc-highlight">SlashingCalculator Constants</a></li></ul></li><li><a href="#bounty-distribution" class="table-of-contents__link toc-highlight">Bounty Distribution</a><ul><li><a href="#distribution-constants" class="table-of-contents__link toc-highlight">Distribution Constants</a></li><li><a href="#concrete-example" class="table-of-contents__link toc-highlight">Concrete Example</a></li><li><a href="#minimum-bounty-requirements" class="table-of-contents__link toc-highlight">Minimum Bounty Requirements</a></li></ul></li><li><a href="#dispute-mechanism" class="table-of-contents__link toc-highlight">Dispute Mechanism</a><ul><li><a href="#who-can-dispute" class="table-of-contents__link toc-highlight">Who Can Dispute</a></li><li><a href="#dispute-flow" class="table-of-contents__link toc-highlight">Dispute Flow</a></li><li><a href="#dispute-rules" class="table-of-contents__link toc-highlight">Dispute Rules</a></li></ul></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a><ul><li><a href="#front-running-protection" class="table-of-contents__link toc-highlight">Front-Running Protection</a></li><li><a href="#replay-attack-prevention" class="table-of-contents__link toc-highlight">Replay Attack Prevention</a></li><li><a href="#reentrancy-protection" class="table-of-contents__link toc-highlight">Reentrancy Protection</a></li><li><a href="#cross-layer-security" class="table-of-contents__link toc-highlight">Cross-Layer Security</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tal/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/tal/architecture/overview">Architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/tal/contracts/identity-registry">Smart Contracts</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Developer Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tal/sdk/overview">SDK Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/tal/app/setup">Frontend App</a></li><li class="footer__item"><a class="footer__link-item" href="/tal/integration/staking-bridge">Integration Guides</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/tokamak-network/Tokamak-AI-Layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Tokamak Network.</div></div></div></footer></div>
</body>
</html>